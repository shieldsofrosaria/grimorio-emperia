<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grimorio Emperia - Student Dashboard</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>ðŸ“œ</text></svg>" type="image/svg+xml">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Cormorant+Garamond:wght@400;600&family=MedievalSharp&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Dark mystical palette */
            --void-black: #0a0514;
            --deep-purple: #1a0f2e;
            --mystic-purple: #2d1b4e;
            --royal-purple: #4a2c6d;
            --arcane-blue: #2a4a7d;
            --celestial-blue: #3d6ba3;
            
            /* Virtue colors */
            --thoth-blue: #4a7dc7;
            --maat-silver: #c0d0e8;
            --caerus-gold: #daa520;
            
            /* Accent colors */
            --mystic-glow: #8b6fd8;
            --arcane-glow: #6ba3ff;
            --gold-glow: #ffd700;
            --text-primary: #e8f0ff;
            --text-secondary: #a8b8d8;
        }

        body {
            font-family: 'Cormorant Garamond', serif;
            background: linear-gradient(135deg, var(--void-black) 0%, var(--deep-purple) 50%, var(--void-black) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated starfield background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, var(--thoth-blue), transparent),
                radial-gradient(1px 1px at 50% 50%, var(--caerus-gold), transparent),
                radial-gradient(1px 1px at 80% 10%, var(--maat-silver), transparent),
                radial-gradient(2px 2px at 90% 60%, var(--arcane-glow), transparent);
            background-size: 200% 200%;
            animation: twinkle 4s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        @keyframes glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(139, 111, 216, 0.3),
                            inset 0 0 30px rgba(139, 111, 216, 0.1);
            }
            50% { 
                box-shadow: 0 0 30px rgba(139, 111, 216, 0.6),
                            inset 0 0 40px rgba(139, 111, 216, 0.2);
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* Debug Badge */
        .debug-badge {
            display: none;
            margin: 10px 0 0 0;
            padding: 6px 12px;
            border: 2px dashed var(--maat-silver);
            border-radius: 999px;
            color: var(--maat-glow);
            background: rgba(255,255,255,0.05);
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            max-width: fit-content;
        }

        .debug-action-btn {
            display: none;
            margin: 8px 0 16px 0;
            padding: 6px 10px;
            border: 2px solid var(--caerus-gold);
            border-radius: 8px;
            background: rgba(218, 165, 32, 0.08);
            color: var(--caerus-gold);
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .debug-action-btn:hover {
            background: rgba(218, 165, 32, 0.15);
        }

        /* Top Navigation */
        .top-nav {
            background: linear-gradient(135deg, rgba(26, 15, 46, 0.95), rgba(74, 44, 109, 0.95));
            border-bottom: 2px solid var(--mystic-glow);
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            gap: 20px;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            color: var(--caerus-gold);
            text-shadow: 0 0 15px var(--gold-glow);
            white-space: nowrap;
        }

        .nav-icon {
            font-size: 1.8rem;
        }

        .nav-title {
            display: none;
        }

        @media (min-width: 768px) {
            .nav-title {
                display: inline;
            }
        }

        .nav-menu {
            display: flex;
            gap: 20px;
            list-style: none;
            margin: 0;
            padding: 0;
            flex-wrap: wrap;
        }

        .nav-link {
            color: var(--text-primary);
            text-decoration: none;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.05rem;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
            display: block;
            white-space: nowrap;
        }

        .nav-link:hover {
            color: var(--caerus-gold);
            background: rgba(218, 165, 32, 0.1);
        }

        .nav-link.active {
            color: var(--caerus-gold);
            background: rgba(218, 165, 32, 0.2);
        }

        .nav-dropdown {
            position: relative;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: linear-gradient(135deg, rgba(26, 15, 46, 0.98), rgba(74, 44, 109, 0.98));
            border: 2px solid var(--mystic-glow);
            border-radius: 10px;
            padding: 10px 0;
            min-width: 280px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
            z-index: 1001;
            margin-top: 5px;
            list-style: none;
            backdrop-filter: blur(10px);
        }

        .nav-dropdown:hover .dropdown-menu {
            display: block;
        }

        .dropdown-menu li {
            padding: 0;
        }

        .dropdown-menu a {
            display: block;
            padding: 12px 20px;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .dropdown-menu a:hover {
            background: rgba(139, 111, 216, 0.3);
            color: var(--caerus-gold);
        }

        .nav-actions {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            padding: 8px 14px;
            background: linear-gradient(135deg, var(--mystic-purple), var(--royal-purple));
            border: 2px solid var(--mystic-glow);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: linear-gradient(135deg, var(--royal-purple), var(--mystic-glow));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 111, 216, 0.5);
        }

        .nav-btn.sync-btn.auto-sync-enabled {
            background: linear-gradient(135deg, var(--caerus-gold), var(--gold-glow));
            color: var(--void-black);
            border-color: var(--caerus-gold);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% { background-position: -100% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Sync Status Indicator */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(45, 27, 78, 0.95);
            border: 2px solid var(--mystic-glow);
            border-radius: 10px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            z-index: 999;
            animation: fadeIn 0.3s ease;
        }

        .sync-status.syncing {
            border-color: var(--thoth-blue);
        }

        .sync-status.success {
            border-color: var(--caerus-gold);
        }

        .sync-status.error {
            border-color: #ff6b6b;
        }

        .sync-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--mystic-glow);
        }

        .sync-status.syncing .sync-indicator {
            background: var(--thoth-blue);
            animation: pulse 1s ease-in-out infinite;
        }

        .sync-status.success .sync-indicator {
            background: var(--caerus-gold);
        }

        .sync-status.error .sync-indicator {
            background: #ff6b6b;
        }

        /* Ornate border frame */
        .main-frame {
            border: 3px solid var(--mystic-purple);
            border-radius: 20px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(26, 15, 46, 0.8), rgba(45, 27, 78, 0.6));
            box-shadow: 
                0 0 40px rgba(139, 111, 216, 0.3),
                inset 0 0 60px rgba(139, 111, 216, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .main-frame::before,
        .main-frame::after {
            content: 'âœ¦';
            position: absolute;
            font-size: 2rem;
            color: var(--caerus-gold);
            text-shadow: 0 0 20px var(--gold-glow);
            animation: float 3s ease-in-out infinite;
            z-index: 100;
            pointer-events: none;
        }

        .main-frame::before { top: 20px; left: 20px; }
        .main-frame::after { top: 20px; right: 20px; animation-delay: 1.5s; }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* Profile Card */
        .profile-card {
            background: linear-gradient(135deg, rgba(45, 27, 78, 0.9), rgba(74, 44, 109, 0.7));
            border: 2px solid var(--royal-purple);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(139, 111, 216, 0.4);
            animation: glow 3s ease-in-out infinite;
            position: relative;
            z-index: 10;
        }

        .profile-card::before {
            content: 'â—†';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            color: var(--mystic-glow);
            opacity: 0.5;
        }

        .profile-actions {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            max-width: calc(100% - 80px);
        }

        .profile-btn {
            background: rgba(139, 111, 216, 0.3);
            border: 1px solid var(--mystic-glow);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .profile-btn:hover {
            background: rgba(139, 111, 216, 0.6);
            transform: scale(1.05);
        }

        .profile-btn.auto-sync-enabled {
            background: rgba(218, 165, 32, 0.3);
            border-color: var(--caerus-gold);
        }

        .profile-header {
            text-align: center;
            margin-bottom: 20px;
            margin-top: 30px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--mystic-glow);
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--deep-purple), var(--royal-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: 0 0 30px rgba(139, 111, 216, 0.5);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .profile-avatar::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s linear infinite;
        }

        .scribe-title {
            font-family: 'Cinzel', serif;
            font-size: 1.4rem;
            color: var(--caerus-gold);
            margin-bottom: 5px;
            text-shadow: 0 0 10px var(--gold-glow);
        }

        .scribe-rank {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Level Display */
        .level-display {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--mystic-purple);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .level-number {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            color: var(--mystic-glow);
            text-shadow: 0 0 20px var(--mystic-glow);
        }

        .level-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Progress bars */
        .progress-section {
            margin-bottom: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .progress-bar {
            height: 12px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--mystic-purple);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--thoth-blue), var(--arcane-glow));
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s linear infinite;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--mystic-purple);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--caerus-gold);
            text-shadow: 0 0 10px var(--gold-glow);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Virtue Progress */
        .virtue-section {
            grid-column: 1 / -1;
        }

        .virtue-card {
            background: linear-gradient(135deg, rgba(45, 27, 78, 0.9), rgba(74, 44, 109, 0.7));
            border: 2px solid var(--royal-purple);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(139, 111, 216, 0.4);
        }

        .virtue-title {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 25px;
            color: var(--maat-silver);
            text-shadow: 0 0 15px var(--maat-silver);
        }

        .virtue-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .virtue-item {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .virtue-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(139, 111, 216, 0.5);
        }

        .virtue-item.thoth {
            border-color: var(--thoth-blue);
        }

        .virtue-item.maat {
            border-color: var(--maat-silver);
        }

        .virtue-item.caerus {
            border-color: var(--caerus-gold);
        }

        .virtue-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px currentColor);
        }

        .virtue-name {
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .virtue-rank {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .virtue-points {
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 0 15px currentColor;
            margin-bottom: 10px;
        }

        .virtue-progress {
            height: 8px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .virtue-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .thoth .virtue-progress-fill {
            background: linear-gradient(90deg, var(--thoth-blue), var(--arcane-glow));
        }

        .maat .virtue-progress-fill {
            background: linear-gradient(90deg, var(--maat-silver), white);
        }

        .caerus .virtue-progress-fill {
            background: linear-gradient(90deg, var(--caerus-gold), var(--gold-glow));
        }

        /* Recent Activity */
        .activity-card {
            background: linear-gradient(135deg, rgba(45, 27, 78, 0.9), rgba(74, 44, 109, 0.7));
            border: 2px solid var(--royal-purple);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(139, 111, 216, 0.4);
            margin-bottom: 30px;
        }

        .activity-title {
            font-family: 'Cinzel', serif;
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--maat-silver);
            text-shadow: 0 0 15px var(--maat-silver);
        }

        .activity-item {
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid var(--mystic-glow);
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .activity-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 1.05rem;
            margin-bottom: 3px;
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Main Tabs for integrated sections */
        .main-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--mystic-purple);
            flex-wrap: wrap;
        }

        .main-tab {
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .main-tab.active {
            color: var(--caerus-gold);
            border-bottom-color: var(--caerus-gold);
            text-shadow: 0 0 10px var(--gold-glow);
        }

        .main-tab:hover {
            color: var(--maat-silver);
        }
        
        .section-subtitle {
            color: var(--caerus-gold);
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            display: block;
            padding: 12px 0;
            text-shadow: 0 0 10px rgba(218, 165, 32, 0.3);
        }

        .main-tab-content {
            display: none;
        }

        .main-tab-content.active {
            display: block;
        }

        /* Profile Tab Styles */
        .profile-compact {
            max-height: 500px;
            overflow-y: auto;
        }

        .profile-field-compact {
            margin-bottom: 20px;
        }

        .field-label-compact {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--maat-silver);
            margin-bottom: 8px;
            display: block;
        }

        .field-content-compact {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-primary);
            min-height: 40px;
            transition: all 0.3s ease;
        }

        .field-content-compact.editable {
            cursor: text;
        }

        .field-content-compact.editable:hover {
            border-color: var(--mystic-glow);
            background: rgba(139, 111, 216, 0.1);
        }

        .field-content-compact.editable:focus {
            outline: none;
            border-color: var(--caerus-gold);
            box-shadow: 0 0 15px rgba(218, 165, 32, 0.3);
        }

        .field-textarea-compact {
            width: 100%;
            min-height: 100px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-primary);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .field-textarea-compact:focus {
            outline: none;
            border-color: var(--caerus-gold);
            box-shadow: 0 0 15px rgba(218, 165, 32, 0.3);
        }

        .save-btn-compact {
            background: linear-gradient(135deg, var(--caerus-gold), var(--gold-glow));
            border: 2px solid var(--caerus-gold);
            color: var(--void-black);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            margin-top: 15px;
            font-weight: 600;
        }

        .save-btn-compact:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(218, 165, 32, 0.5);
        }

        /* Notes Tab Styles */
        .add-note-compact {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--mystic-purple);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .note-select-compact {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--mystic-purple);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .note-select-compact option {
            background: var(--deep-purple);
            color: var(--text-primary);
        }

        .note-textarea-compact {
            width: 100%;
            min-height: 80px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-primary);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 10px;
        }

        .note-textarea-compact:focus {
            outline: none;
            border-color: var(--mystic-glow);
            box-shadow: 0 0 15px rgba(139, 111, 216, 0.5);
        }

        .notes-compact {
            max-height: 400px;
            overflow-y: auto;
        }

        .note-item-compact {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--mystic-purple);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            position: relative;
            transition: all 0.3s ease;
        }

        .note-item-compact:hover {
            border-color: var(--mystic-glow);
            box-shadow: 0 5px 20px rgba(139, 111, 216, 0.3);
        }

        .note-header-compact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--mystic-purple);
        }

        .note-date-compact {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .note-category-compact {
            background: rgba(139, 111, 216, 0.3);
            color: var(--mystic-glow);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .note-content-compact {
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 0.95rem;
            border-radius: 5px;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .note-actions-compact {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 10px;
        }

        .note-edit-compact,
        .note-delete-compact {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--mystic-purple);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            font-family: 'Cormorant Garamond', serif;
        }

        .note-edit-compact:hover {
            border-color: var(--caerus-gold);
            color: var(--caerus-gold);
            background: rgba(218, 165, 32, 0.1);
        }

        .note-delete-compact:hover {
            border-color: #ff6b6b;
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        .note-save-edit {
            margin-top: 10px;
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--mystic-purple), var(--royal-purple));
            border: 2px solid var(--caerus-gold);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            transition: all 0.3s ease;
            width: 100%;
        }

        .note-save-edit:hover {
            background: linear-gradient(135deg, var(--royal-purple), var(--mystic-glow));
            transform: translateY(-2px);
        }

        /* Toolkit Tab Styles */
        .toolkit-subtabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .toolkit-subtab {
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toolkit-subtab.active {
            background: linear-gradient(135deg, var(--mystic-purple), var(--royal-purple));
            border-color: var(--mystic-glow);
            color: var(--text-primary);
        }

        .toolkit-subtab:hover {
            border-color: var(--mystic-glow);
        }

        .toolkit-subtab-content {
            display: none;
        }

        .toolkit-subtab-content.active {
            display: block;
        }

        .progress-badge {
            background: rgba(218, 165, 32, 0.2);
            border: 2px solid var(--caerus-gold);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            font-size: 1.2rem;
            color: var(--caerus-gold);
            margin-bottom: 20px;
        }

        .toolkit-categories {
            max-height: 400px;
            overflow-y: auto;
        }

        .toolkit-category-compact {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 10px;
            margin-bottom: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .category-header-compact {
            padding: 12px 15px;
            background: rgba(74, 44, 109, 0.5);
            color: var(--maat-silver);
            font-family: 'Cinzel', serif;
            font-size: 1.05rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .category-header-compact:hover {
            background: rgba(74, 44, 109, 0.7);
            color: var(--caerus-gold);
        }

        .category-count {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .category-items {
            padding: 10px;
        }

        .checklist-item-compact {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .checklist-item-compact:hover {
            background: rgba(139, 111, 216, 0.2);
        }

        .checkbox-compact {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--caerus-gold);
        }

        .checklist-item-compact label {
            flex: 1;
            color: var(--text-primary);
            font-size: 0.95rem;
            cursor: pointer;
        }

        .price-tag {
            color: var(--caerus-gold);
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Digital Apps */
        .digital-apps {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .app-compact {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--mystic-purple);
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s ease;
        }

        .app-compact:hover {
            border-color: var(--mystic-glow);
            box-shadow: 0 5px 15px rgba(139, 111, 216, 0.3);
        }

        .app-name-compact {
            font-family: 'Cinzel', serif;
            font-size: 1.05rem;
            color: var(--maat-silver);
            margin-bottom: 5px;
        }

        .app-desc-compact {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Scrollbar styling */
        .profile-compact::-webkit-scrollbar,
        .notes-compact::-webkit-scrollbar,
        .toolkit-categories::-webkit-scrollbar,
        .digital-apps::-webkit-scrollbar {
            width: 8px;
        }

        .profile-compact::-webkit-scrollbar-track,
        .notes-compact::-webkit-scrollbar-track,
        .toolkit-categories::-webkit-scrollbar-track,
        .digital-apps::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .profile-compact::-webkit-scrollbar-thumb,
        .notes-compact::-webkit-scrollbar-thumb,
        .toolkit-categories::-webkit-scrollbar-thumb,
        .digital-apps::-webkit-scrollbar-thumb {
            background: var(--mystic-glow);
            border-radius: 10px;
        }

        .profile-compact::-webkit-scrollbar-thumb:hover,
        .notes-compact::-webkit-scrollbar-thumb:hover,
        .toolkit-categories::-webkit-scrollbar-thumb:hover,
        .digital-apps::-webkit-scrollbar-thumb:hover {
            background: var(--caerus-gold);
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .action-btn {
            background: linear-gradient(135deg, var(--mystic-purple), var(--royal-purple));
            border: 2px solid var(--mystic-glow);
            border-radius: 10px;
            padding: 20px;
            color: var(--text-primary);
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: block;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(139, 111, 216, 0.6);
            background: linear-gradient(135deg, var(--royal-purple), var(--mystic-glow));
        }

        .action-icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 8px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 5, 20, 0.95);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(26, 15, 46, 0.95), rgba(45, 27, 78, 0.95));
            border: 3px solid var(--mystic-glow);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(139, 111, 216, 0.6);
            animation: fadeIn 0.3s ease;
            position: relative;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--caerus-gold);
            text-shadow: 0 0 15px var(--gold-glow);
            margin-bottom: 10px;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: var(--caerus-gold);
            transform: scale(1.2);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: var(--maat-silver);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--mystic-purple);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.05rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--mystic-glow);
            box-shadow: 0 0 15px rgba(139, 111, 216, 0.5);
        }

        .avatar-upload-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .avatar-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 3px solid var(--mystic-glow);
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--deep-purple), var(--royal-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            box-shadow: 0 0 30px rgba(139, 111, 216, 0.5);
            overflow: hidden;
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .avatar-option {
            font-size: 2rem;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .avatar-option:hover,
        .avatar-option.selected {
            border-color: var(--mystic-glow);
            background: rgba(139, 111, 216, 0.3);
            transform: scale(1.1);
        }

        .upload-btn, .save-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .upload-btn {
            background: linear-gradient(135deg, var(--thoth-blue), var(--arcane-glow));
            color: white;
        }

        .save-btn {
            background: linear-gradient(135deg, var(--caerus-gold), var(--gold-glow));
            color: var(--void-black);
        }

        .upload-btn:hover, .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(218, 165, 32, 0.6);
        }

        .upload-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        #avatarFileInput {
            display: none;
        }

        /* Cloud Sync Styles */
        .sync-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--mystic-purple);
        }

        .sync-tab {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sync-tab.active {
            color: var(--caerus-gold);
            border-bottom-color: var(--caerus-gold);
        }

        .sync-tab:hover {
            color: var(--maat-silver);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .sync-code-display {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--caerus-gold);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }

        .sync-code {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            color: var(--caerus-gold);
            text-shadow: 0 0 20px var(--gold-glow);
            letter-spacing: 5px;
            margin: 15px 0;
            user-select: all;
            animation: pulse 2s ease-in-out infinite;
        }

        .qr-code-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            display: inline-block;
            margin: 20px 0;
        }

        .qr-code-container canvas {
            display: block;
        }

        .code-input-section {
            margin: 20px 0;
        }

        .code-input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--mystic-purple);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 1.3rem;
            text-align: center;
            letter-spacing: 3px;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .code-input:focus {
            outline: none;
            border-color: var(--caerus-gold);
            box-shadow: 0 0 20px rgba(218, 165, 32, 0.5);
        }

        .sync-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .sync-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sync-btn.primary {
            background: linear-gradient(135deg, var(--caerus-gold), var(--gold-glow));
            color: var(--void-black);
        }

        .sync-btn.secondary {
            background: linear-gradient(135deg, var(--mystic-purple), var(--royal-purple));
            color: var(--text-primary);
            border: 2px solid var(--mystic-glow);
        }

        .sync-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(139, 111, 216, 0.5);
        }

        .sync-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .info-text {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-style: italic;
            text-align: center;
            margin: 10px 0;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin-left: 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--mystic-purple);
            transition: 0.4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: var(--text-secondary);
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--caerus-gold), var(--gold-glow));
            border-color: var(--caerus-gold);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(28px);
            background-color: var(--void-black);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .virtue-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Footer */
        .main-footer {
            background: linear-gradient(135deg, rgba(26, 15, 46, 0.95), rgba(74, 44, 109, 0.95));
            border-top: 2px solid var(--mystic-glow);
            margin-top: 60px;
            padding: 40px 20px 20px;
            backdrop-filter: blur(10px);
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid var(--mystic-purple);
        }

        .footer-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .footer-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            color: var(--caerus-gold);
            margin: 0;
            text-shadow: 0 0 15px var(--gold-glow);
        }

        .footer-subtitle {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-style: italic;
            color: var(--maat-silver);
            margin: 0;
        }

        .footer-tagline {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .footer-heading {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: var(--maat-silver);
            margin: 0 0 10px 0;
        }

        .footer-links {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .footer-links a {
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            padding: 5px 0;
        }

        .footer-links a:hover {
            color: var(--caerus-gold);
            padding-left: 10px;
        }

        .hub-link {
            display: inline-block;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--mystic-purple), var(--royal-purple));
            border: 2px solid var(--mystic-glow);
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-align: center;
        }

        .hub-link:hover {
            background: linear-gradient(135deg, var(--royal-purple), var(--mystic-glow));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 111, 216, 0.5);
        }

        .footer-note {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
            margin: 5px 0 0 0;
        }

        .footer-bottom {
            max-width: 1400px;
            margin: 0 auto;
            padding-top: 20px;
            text-align: center;
        }

        .footer-bottom .trinity-symbols {
            font-size: 2rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px rgba(218, 165, 32, 0.4));
        }

        .footer-motto {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-style: italic;
            color: var(--caerus-gold);
            margin: 10px 0;
        }

        .footer-copyright {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 5px 0 0 0;
        }

        /* Profile View/Edit Toggle */
        .profile-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .toggle-edit-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--mystic-purple), var(--royal-purple));
            border: 2px solid var(--mystic-glow);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-edit-btn:hover {
            background: linear-gradient(135deg, var(--royal-purple), var(--mystic-glow));
            transform: translateY(-2px);
        }

        .profile-display-card {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .profile-section-header {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: var(--caerus-gold);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--mystic-purple);
        }

        .profile-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .profile-info-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .profile-info-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .profile-info-value {
            font-size: 1.1rem;
            color: var(--text-primary);
            font-family: 'Cinzel', serif;
        }

        .profile-backstory-text {
            color: var(--text-primary);
            line-height: 1.8;
            font-size: 1.05rem;
            text-align: justify;
        }

        .profile-goals-list {
            list-style: none;
            padding: 0;
        }

        .profile-goals-list li {
            padding: 10px;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.2);
            border-left: 3px solid var(--caerus-gold);
            border-radius: 5px;
            color: var(--text-primary);
        }

        .profile-goals-list li:before {
            content: 'â­ ';
            color: var(--caerus-gold);
        }

        /* Profile Photo Sections */
        .profile-photo-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .profile-photo-preview,
        .profile-photo-preview-edit {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 3px solid var(--caerus-gold);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            background: linear-gradient(135deg, rgba(45, 27, 78, 0.5), rgba(74, 44, 109, 0.3));
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(218, 165, 32, 0.3);
        }

        .profile-photo-preview img,
        .profile-photo-preview-edit img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-photo-caption {
            color: var(--text-secondary);
            font-style: italic;
            font-size: 0.9rem;
        }

        .profile-photo-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .upload-photo-btn,
        .remove-photo-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--mystic-purple);
        }

        .upload-photo-btn {
            background: linear-gradient(135deg, var(--mystic-purple), var(--royal-purple));
            color: var(--text-primary);
        }

        .upload-photo-btn:hover {
            background: linear-gradient(135deg, var(--royal-purple), var(--mystic-glow));
            transform: translateY(-2px);
        }

        .remove-photo-btn {
            background: rgba(139, 111, 216, 0.2);
            color: var(--text-secondary);
        }

        .remove-photo-btn:hover {
            background: rgba(218, 32, 32, 0.3);
            border-color: #da2020;
            color: #ff6b6b;
        }

        /* Specialization Card Styles */
        .spec-card {
            background: linear-gradient(135deg, rgba(45, 27, 78, 0.4), rgba(74, 44, 109, 0.2));
            border: 2px solid var(--caerus-gold);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .spec-card.locked {
            border-color: rgba(212, 175, 55, 0.3);
            opacity: 0.6;
            background: linear-gradient(135deg, rgba(45, 27, 78, 0.2), rgba(74, 44, 109, 0.1));
        }

        .spec-card.unlocked:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(218, 165, 32, 0.4);
            border-color: var(--caerus-bright);
        }

        .spec-header {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .spec-icon {
            font-size: 1.8rem;
        }

        .spec-info {
            flex: 1;
        }

        .spec-title {
            font-weight: 600;
            color: var(--caerus-gold);
            font-size: 1rem;
            font-family: 'Cinzel', serif;
        }

        .spec-status {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .spec-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.4;
        }

        .spec-progress {
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--caerus-deep), var(--caerus-bright));
            border-radius: 4px;
        }

        .field-input-compact {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-primary);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .field-input-compact:focus {
            outline: none;
            border-color: var(--caerus-gold);
            box-shadow: 0 0 15px rgba(218, 165, 32, 0.3);
        }

        /* Moon Tracker Tab */
        .moon-tracker-card {
            max-height: 500px;
            overflow-y: auto;
        }

        .current-moon-phase {
            text-align: center;
            background: linear-gradient(135deg, rgba(74, 125, 199, 0.2), rgba(192, 208, 232, 0.1));
            border: 2px solid var(--thoth-blue);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
        }

        .moon-icon-large {
            font-size: 5rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.5));
        }

        .moon-phase-name {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: var(--maat-silver);
            margin-bottom: 8px;
        }

        .moon-phase-date {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .moon-calendar, .moon-workings {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .moon-section-header {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: var(--caerus-gold);
            margin-bottom: 15px;
        }

        .moon-phases-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .moon-phase-item {
            display: flex;
            gap: 15px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-left: 3px solid var(--thoth-blue);
            transition: all 0.3s ease;
        }

        .moon-phase-item:hover {
            background: rgba(74, 125, 199, 0.2);
            transform: translateX(5px);
        }

        .moon-icon-small {
            font-size: 2rem;
        }

        .moon-phase-info {
            flex: 1;
        }

        .moon-phase-type {
            font-size: 1.05rem;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .moon-phase-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .moon-note {
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .moon-activities {
            list-style: none;
            padding: 0;
        }

        .moon-activities li {
            padding: 8px 0;
            color: var(--text-primary);
            border-bottom: 1px solid rgba(139, 111, 216, 0.2);
        }

        .moon-activities li:last-child {
            border-bottom: none;
        }
        
        /* Visual Moon Phase Display */
        .moon-visual {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #e8f0ff, #d4e4f7);
            border-radius: 50%;
            position: relative;
            box-shadow: 
                0 0 30px rgba(255, 255, 255, 0.3),
                inset 0 0 30px rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }
        
        .moon-shadow {
            position: absolute;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(10, 5, 20, 0) 0%,
                rgba(10, 5, 20, 0.8) 50%,
                rgba(10, 5, 20, 1) 100%
            );
            border-radius: 50%;
            transition: all 0.5s ease;
        }
        
        .moon-illumination {
            font-size: 0.95rem;
            color: var(--thoth-blue);
            margin-top: 8px;
            font-weight: 600;
        }
        
        .moon-countdown {
            background: linear-gradient(135deg, rgba(218, 165, 32, 0.1), rgba(139, 111, 216, 0.1));
            border: 2px solid var(--caerus-gold);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .countdown-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .countdown-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }
        
        .countdown-value {
            font-size: 2rem;
            font-family: 'Cinzel', serif;
            color: var(--caerus-gold);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(218, 165, 32, 0.5);
        }
        
        .countdown-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .phase-guidance-card {
            background: rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--thoth-blue);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .guidance-title {
            font-family: 'Cinzel', serif;
            color: var(--caerus-gold);
            font-size: 1.05rem;
            margin-bottom: 10px;
        }
        
        .guidance-list {
            list-style: none;
            padding: 0;
        }
        
        .guidance-list li {
            padding: 6px 0;
            color: var(--text-primary);
            border-bottom: 1px solid rgba(139, 111, 216, 0.15);
        }
        
        .guidance-list li:last-child {
            border-bottom: none;
        }

        /* Progress Report Tab */
        .progress-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .progress-stat-card {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .progress-stat-card:hover {
            border-color: var(--caerus-gold);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(218, 165, 32, 0.3);
        }

        .progress-stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .progress-stat-value {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: var(--caerus-gold);
            margin-bottom: 5px;
        }

        .progress-stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .virtue-breakdown, .recent-achievements {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .progress-section-header {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: var(--maat-silver);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--mystic-purple);
        }

        .virtue-progress-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .virtue-progress-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .virtue-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.05rem;
            color: var(--text-primary);
        }

        .virtue-progress-bar {
            height: 12px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 6px;
            overflow: hidden;
        }

        .thoth-fill {
            background: linear-gradient(90deg, var(--thoth-blue), var(--thoth-bright));
        }

        .maat-fill {
            background: linear-gradient(90deg, var(--maat-silver), var(--maat-bright));
        }

        .caerus-fill {
            background: linear-gradient(90deg, var(--caerus-gold), var(--gold-glow));
        }

        .virtue-progress-rank {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .achievement-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .achievement-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 3px solid var(--caerus-gold);
            transition: all 0.3s ease;
        }

        .achievement-item:hover {
            background: rgba(218, 165, 32, 0.1);
            transform: translateX(5px);
        }

        .achievement-badge {
            font-size: 2.5rem;
            flex-shrink: 0;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-name {
            font-size: 1.1rem;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .achievement-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Volume Tabs */
        .volume-subtabs {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0 30px 0;
            flex-wrap: wrap;
        }

        .volume-subtab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(45, 27, 78, 0.5), rgba(74, 44, 109, 0.3));
            border: 2px solid var(--mystic-purple);
            color: var(--text-primary);
            font-family: 'Cinzel Decorative', serif;
            font-size: 1.5rem;
            cursor: pointer;
            transition:
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .volume-subtab:hover {
            border-color: var(--caerus-gold);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(218, 165, 32, 0.4);
        }

        .volume-subtab.active {
            background: linear-gradient(135deg, var(--caerus-gold), var(--gold-glow));
            border-color: var(--gold-glow);
            color: var(--void-black);
            box-shadow: 0 4px 20px rgba(218, 165, 32, 0.6);
        }

        .volume-content-container {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--mystic-purple);
            border-radius: 12px;
            padding: 30px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
        }

        .loading-message {
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
            padding: 50px;
            font-size: 1.1rem;
        }

        /* Volume Content Styling */
        .volume-content-container h2 {
            font-family: 'Cinzel Decorative', serif;
            font-size: 1.8rem;
            color: var(--caerus-gold);
            margin-bottom: 15px;
        }

        .volume-content-container h3 {
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            color: var(--text-primary);
            margin: 25px 0 12px 0;
        }

        .volume-content-container p {
            color: var(--text-primary);
            line-height: 1.7;
            margin: 12px 0;
        }

        .volume-content-container ul {
            color: var(--text-primary);
            margin: 10px 0 10px 20px;
        }

        .volume-content-container strong {
            color: var(--caerus-gold);
        }

        /* Quest System Styles */
        .quest-section {
            margin-bottom: 30px;
        }

        .quest-section-header {
            font-size: 1.3rem;
            color: var(--caerus-gold);
            font-family: 'Cinzel', serif;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--mystic-purple);
        }

        .quest-grid {
            display: grid;
            gap: 15px;
        }

        .quest-card {
            background: linear-gradient(135deg, rgba(45, 27, 78, 0.4), rgba(74, 44, 109, 0.2));
            border: 2px solid var(--mystic-purple);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .quest-card:hover {
            border-color: var(--caerus-gold);
            box-shadow: 0 5px 20px rgba(218, 165, 32, 0.3);
            transform: translateY(-2px);
        }

        .quest-card.completed {
            opacity: 0.6;
            border-color: var(--maat-silver);
        }

        .quest-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .quest-title {
            font-size: 1.1rem;
            color: var(--caerus-gold);
            font-family: 'Cinzel', serif;
            font-weight: 600;
        }

        .quest-virtue {
            font-size: 1.5rem;
        }

        .quest-description {
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .quest-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }

        .quest-reward {
            color: var(--caerus-bright);
            font-weight: 600;
        }

        .quest-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--caerus-gold);
        }

        .quest-timer {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .quest-timer-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .quest-timer-value {
            color: var(--caerus-gold);
            font-size: 1.5rem;
            font-family: 'Cinzel', serif;
            font-weight: 600;
        }

        /* Quill Rich Text Editor Styling */
        .ql-toolbar {
            background: rgba(0, 0, 0, 0.4) !important;
            border: 2px solid var(--mystic-purple) !important;
            border-bottom: none !important;
            border-radius: 8px 8px 0 0 !important;
        }

        .ql-container {
            background: rgba(0, 0, 0, 0.3) !important;
            border: 2px solid var(--mystic-purple) !important;
            border-top: none !important;
            border-radius: 0 0 8px 8px !important;
            font-family: 'Cormorant Garamond', serif !important;
        }

        .ql-editor {
            color: var(--text-primary) !important;
            min-height: 120px !important;
            padding: 15px !important;
        }

        .ql-editor.ql-blank::before {
            color: var(--text-secondary) !important;
            font-style: italic;
        }

        .ql-toolbar button:hover,
        .ql-toolbar button.ql-active,
        .ql-toolbar button:focus {
            color: var(--caerus-gold) !important;
        }

        .ql-stroke {
            stroke: var(--text-primary) !important;
        }

        .ql-stroke.ql-active,
        .ql-stroke.ql-hover,
        .ql-picker-label {
            stroke: var(--caerus-gold) !important;
        }

        .ql-fill,
        .ql-stroke.ql-fill {
            fill: var(--text-primary) !important;
        }

        .ql-fill.ql-active,
        .ql-fill.ql-hover,
        .ql-stroke.ql-fill.ql-active,
        .ql-stroke.ql-fill.ql-hover {
            fill: var(--caerus-gold) !important;
        }

        .ql-picker {
            color: var(--text-primary) !important;
        }

        .ql-picker-options {
            background: var(--void-black) !important;
            border: 1px solid var(--mystic-purple) !important;
        }

        .ql-picker-item {
            color: var(--text-primary) !important;
        }

        .ql-picker-item.ql-selected,
        .ql-picker-item:hover {
            color: var(--caerus-gold) !important;
            background: rgba(212, 175, 32, 0.1) !important;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .avatar-picker {
                grid-template-columns: repeat(4, 1fr);
            }

            .modal-content {
                padding: 30px 20px;
            }

            .profile-actions {
                position: static;
                justify-content: center;
                margin-bottom: 15px;
            }

            .sync-code {
                font-size: 1.5rem;
                letter-spacing: 3px;
            }

            .sync-buttons {
                grid-template-columns: 1fr;
            }

            .sync-status {
                bottom: 10px;
                right: 10px;
                font-size: 0.8rem;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="nav-icon">ðŸŽ“</span>
                <span class="nav-title">Empirical Academy</span>
            </div>
            
            <ul class="nav-menu">
                <li><a href="#" onclick="switchSection('dashboard'); return false;" class="nav-link active">ðŸŽ® Dashboard</a></li>
                <li><a href="#" onclick="switchSection('study'); return false;" class="nav-link">ðŸ“š Study</a></li>
                <li><a href="#" onclick="switchSection('volumes'); return false;" class="nav-link">ðŸ“– Volumes</a></li>
                <li><a href="#" onclick="switchSection('practice'); return false;" class="nav-link">ðŸŽ¯ Practice</a></li>
                <li><a href="#" onclick="switchSection('you'); return false;" class="nav-link">ðŸ‘¤ You</a></li>
            </ul>

            <div class="nav-actions">
                <button class="nav-btn edit-btn" onclick="switchSection('you'); toggleProfileEdit(); return false;">
                    âœï¸ Edit
                </button>
                <button class="nav-btn sync-btn" id="navSyncBtn" onclick="openSyncModal()">
                    <span id="navSyncIcon">â˜ï¸</span>
                    <span id="navSyncText">Sync</span>
                </button>
                <button class="nav-btn" id="navDebugBtn" onclick="toggleDebugMode()" title="Toggle Debug">ðŸž Debug</button>
            </div>
        </div>
    </nav>

    <!-- Sync Status Indicator -->
    <div id="syncStatus" class="sync-status" style="display: none;">
        <div class="sync-indicator"></div>
        <span id="syncStatusText">Ready</span>
    </div>

    <div class="container">
        <div class="main-frame">
            <div class="dashboard-grid">
                <!-- Profile Card -->
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar" onclick="switchSection('you'); return false;">
                            ðŸ“œ
                        </div>
                        <h2 class="scribe-title" id="scribeName">Lord Edmund Ashford</h2>
                        <p class="scribe-rank" id="scribeRank">Apprentice Scribe</p>
                    </div>

                    <div class="level-display">
                        <div class="level-number" id="currentLevel">5</div>
                        <div class="level-label">Current Level</div>
                    </div>

                    <div class="progress-section">
                        <div class="progress-label">
                            <span>Experience</span>
                            <span id="xpDisplay">1,250 / 2,000</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="xpBar" style="width: 62.5%"></div>
                        </div>
                    </div>

                    <div class="progress-section">
                        <div class="progress-label">
                            <span>Study Focus</span>
                            <span id="focusDisplay">75%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="focusBar" style="width: 75%"></div>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="totalWorkings">28</div>
                            <div class="stat-label">Workings</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="daysActive">14</div>
                            <div class="stat-label">Days Active</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="moonPhase">ðŸŒ•</div>
                            <div class="stat-label">Moon Phase</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="todayPlanet">â™ƒ</div>
                            <div class="stat-label">Today's Planet</div>
                        </div>
                    </div>
                </div>

                <!-- Tabbed Activity/Profile/Notes/Toolkit Section -->
                <div class="activity-card">
                    <!-- Dynamic Main Tabs (changes based on section) -->
                    <div class="main-tabs" id="dynamicTabs">
                        <!-- Tabs will be populated by JavaScript based on active section -->
                    </div>

                    <!-- Activity Tab (Dashboard Section) -->
                    <div id="activityTabContent" class="main-tab-content active">
                        <!-- Quests Section -->
                        <h3 class="activity-title">â­ Daily Quests & Challenges</h3>
                        <div id="debugBadge" class="debug-badge">ðŸž Debug: initializingâ€¦</div>
                        <button id="debugCompleteDailyBtn" class="debug-action-btn" onclick="completeAllDailyQuestsDebug()">Complete all daily quests</button>
                        
                        <!-- Daily Quests -->
                        <div class="quest-section">
                            <div class="quest-section-header">ðŸ“… Daily Quests</div>
                            <div class="quest-timer">
                                <div class="quest-timer-label">Resets in</div>
                                <div class="quest-timer-value" id="dailyTimer">--:--:--</div>
                            </div>
                            <div class="quest-grid" id="dailyQuests">
                                <!-- Daily quests will be populated here -->
                            </div>
                        </div>

                        <!-- Weekly Quests -->
                        <div class="quest-section">
                            <div class="quest-section-header">ðŸ“† Weekly Quests</div>
                            <div class="quest-timer">
                                <div class="quest-timer-label">Resets in</div>
                                <div class="quest-timer-value" id="weeklyTimer">--:--:--</div>
                            </div>
                            <div class="quest-grid" id="weeklyQuests">
                                <!-- Weekly quests will be populated here -->
                            </div>
                        </div>

                        <!-- Monthly Quests -->
                        <div class="quest-section">
                            <div class="quest-section-header">ðŸ“Š Monthly Quests</div>
                            <div class="quest-timer">
                                <div class="quest-timer-label">Resets in</div>
                                <div class="quest-timer-value" id="monthlyTimer">--:--:--</div>
                            </div>
                            <div class="quest-grid" id="monthlyQuests">
                                <!-- Monthly quests will be populated here -->
                            </div>
                        </div>

                        <!-- Activity Feed Section -->
                        <h3 class="activity-title" style="margin-top: 40px;">ðŸ†• Recent Activity</h3>
                        <div id="activityFeed">
                            <div class="activity-item" style="opacity: 0.5; text-align: center; padding: 30px;">
                                <div class="activity-content">
                                    <div class="activity-text">No activities yet. Complete quests, write journal entries, or log workings to see your activity here!</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Tab -->
                    <div id="profileTabContent" class="main-tab-content">
                        <div class="profile-view-header">
                            <h3 class="activity-title">ðŸ‘¤ Character Profile</h3>
                            <button class="toggle-edit-btn" onclick="toggleProfileEdit()" id="profileToggleBtn">
                                âœï¸ Edit Mode
                            </button>
                        </div>
                        
                        <!-- VIEW MODE -->
                        <div id="profileViewMode" class="profile-view-mode">
                            <div class="profile-display-card">
                                <div class="profile-section-header">ðŸ“¸ Profile Photo</div>
                                <div class="profile-photo-display">
                                    <div class="profile-photo-preview" id="viewProfilePhoto">
                                        ðŸ“œ
                                    </div>
                                    <div class="profile-photo-caption">Your character portrait</div>
                                </div>
                            </div>

                            <div class="profile-display-card">
                                <div class="profile-section-header">ðŸ“‹ Scribe Information</div>
                                <div class="profile-info-grid">
                                    <div class="profile-info-item">
                                        <div class="profile-info-label">ðŸŒ™ Scribe Name</div>
                                        <div class="profile-info-value" id="viewFullName">Unnamed Scribe</div>
                                    </div>
                                    <div class="profile-info-item">
                                        <div class="profile-info-label">âš¡ Patron Virtue</div>
                                        <div class="profile-info-value" id="viewPatronVirtue">Thoth</div>
                                    </div>
                                    <div class="profile-info-item">
                                        <div class="profile-info-label">âœ¨ Motto</div>
                                        <div class="profile-info-value" id="viewPersonalMotto" style="font-style: italic;">Amo Ä‰iujn, fidu malmultajn, difektu neniun</div>
                                    </div>
                                    <div class="profile-info-item">
                                        <div class="profile-info-label">ðŸ“… Oath Date</div>
                                        <div class="profile-info-value" id="viewOathDate">Not Set</div>
                                    </div>
                                    <div class="profile-info-item">
                                        <div class="profile-info-label">ðŸ•¯ï¸ Studiolo Location</div>
                                        <div class="profile-info-value" id="viewOrigin">My Sacred Space</div>
                                    </div>
                                </div>
                            </div>

                            <div class="profile-display-card">
                                <div class="profile-section-header">ðŸŽ¯ Current Study Focus</div>
                                <div class="profile-backstory-text" id="viewCurrentFocus">
                                    Beginning the path of the Three Virtues
                                </div>
                            </div>

                            <div class="profile-display-card">
                                <div class="profile-section-header">ðŸ“– Character Backstory</div>
                                <div class="profile-backstory-text" id="viewBackstory">
                                    Share your character's story and journey...
                                </div>
                            </div>

                            <div class="profile-display-card">
                                <div class="profile-section-header">ðŸŽ¯ Current Goals</div>
                                <ul class="profile-goals-list" id="viewGoals">
                                    <li>Begin your journey</li>
                                </ul>
                            </div>
                        </div>

                        <!-- EDIT MODE -->
                        <div id="profileEditMode" class="profile-edit-mode" style="display: none;">
                            <div class="profile-compact">
                                <div class="profile-field-compact">
                                    <label class="field-label-compact">ðŸŽ­ Profile Photo</label>
                                    <div class="profile-photo-upload">
                                        <div class="profile-photo-preview-edit" id="editProfilePhotoPreview">
                                            ðŸ“œ
                                        </div>
                                        <input type="file" id="editProfilePhotoInput" accept="image/*" style="display: none;" onchange="handleProfilePhotoUpload(event)">
                                        <button class="upload-photo-btn" onclick="document.getElementById('editProfilePhotoInput').click()">
                                            ðŸ“¸ Upload Photo
                                        </button>
                                        <button class="remove-photo-btn" onclick="removeProfilePhoto()">
                                            ðŸ—‘ï¸ Remove
                                        </button>
                                    </div>
                                </div>

                                <div class="profile-field-compact">
                                    <label class="field-label-compact">ðŸŒ™ Scribe Name</label>
                                    <input type="text" class="field-input-compact" id="editScribeName" placeholder="Your name or magical name">
                                </div>

                                <div class="profile-field-compact">
                                    <label class="field-label-compact">âœ¨ Personal Motto</label>
                                    <input type="text" class="field-input-compact" id="editPersonalMotto" placeholder="Your guiding principle">
                                </div>

                                <div class="profile-field-compact">
                                    <label class="field-label-compact">ðŸ“… Oath Date (When you began)</label>
                                    <input type="date" class="field-input-compact" id="editOathDate">
                                </div>

                                <div class="profile-field-compact">
                                    <label class="field-label-compact">ðŸŽ¯ Current Study Focus</label>
                                    <textarea class="field-textarea-compact" id="editCurrentFocus" placeholder="What are you focusing on this moon cycle?"></textarea>
                                </div>

                                <div class="profile-field-compact">
                                    <label class="field-label-compact">ðŸ•¯ï¸ Studiolo Location</label>
                                    <input type="text" class="field-input-compact" id="editStudioloLocation" placeholder="E.g., 'The Midnight Garden', 'Tower Study'">
                                </div>

                                <div class="profile-field-compact">
                                    <label class="field-label-compact">âš¡ Patron Virtue</label>
                                    <select class="field-input-compact" id="editPatronVirtue">
                                        <option value="thoth">ðŸŒ™ Thoth (Wisdom)</option>
                                        <option value="maat">âš–ï¸ Ma'at (Balance)</option>
                                        <option value="caerus">âš¡ Caerus (Timing)</option>
                                    </select>
                                </div>

                                <div class="profile-field-compact" style="border-top: 1px solid rgba(212, 175, 55, 0.2); padding-top: 20px; margin-top: 20px;">
                                    <label class="field-label-compact">ðŸ“– Character Background</label>
                                    <textarea class="field-textarea-compact" id="editBackstory" placeholder="Tell your character's story..."></textarea>
                                </div>

                                <div class="profile-field-compact">
                                    <label class="field-label-compact">ðŸŽ¯ Current Goals (one per line)</label>
                                    <textarea class="field-textarea-compact" id="editGoals" placeholder="Master the Three Virtues path&#10;Create comprehensive grimoire&#10;etc."></textarea>
                                </div>

                                <div class="profile-field-compact" style="border-top: 1px solid rgba(212, 175, 55, 0.2); padding-top: 20px; margin-top: 20px;">
                                    <label class="field-label-compact">ðŸ““ In-Character Reflection</label>
                                    <div id="editJournalReflection" style="min-height: 150px; background: rgba(0, 0, 0, 0.3); border: 2px solid var(--mystic-purple); border-radius: 8px;"></div>
                                </div>

                                <button class="save-btn-compact" onclick="saveProfileChanges()">ðŸ’¾ Save All Changes</button>
                            </div>
                        </div>

                        <!-- Specialization Paths (in view mode) -->
                        <div id="profileSpecializations" style="display: none; margin-top: 30px; border-top: 1px solid rgba(212, 175, 55, 0.2); padding-top: 20px;">
                            <h4 style="color: var(--caerus-gold); margin-bottom: 15px;">ðŸ”± Specialization Paths</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 15px;">Unlock specializations at Journeyman rank (500+ total points)</p>
                            <div id="specGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                                <!-- Specializations will be populated here -->
                            </div>
                        </div>

                        <!-- Reflection Journal (in view mode) -->
                        <div id="profileJournal" style="display: none; margin-top: 30px; border-top: 1px solid rgba(212, 175, 55, 0.2); padding-top: 20px;">
                            <h4 style="color: var(--caerus-gold); margin-bottom: 15px;">ðŸ““ In-Character Reflection</h4>
                            <div style="background: rgba(26, 35, 50, 0.6); padding: 15px; border-radius: 10px; border-left: 4px solid var(--caerus-bright);">
                                <p id="journalText" style="font-style: italic; color: var(--maat-bright); line-height: 1.8; min-height: 60px;">
                                    No reflection yet. Share your thoughts about your journey through the Three Virtues.
                                </p>
                            </div>
                            <div style="margin-top: 12px;">
                                <textarea class="field-textarea-compact" id="editJournal" placeholder="Write your in-character reflection..."></textarea>
                                <button class="save-btn-compact" onclick="saveJournalReflection()" style="margin-top: 8px;">ðŸ’¾ Save Reflection</button>
                            </div>
                        </div>
                    </div>

                    <!-- Notes Tab -->
                    <div id="notesTabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸ“ Study Notes</h3>
                        
                        <!-- Add Note Form (Compact) -->
                        <div class="add-note-compact">
                            <select class="note-select-compact" id="noteCategory">
                                <option value="">Category...</option>
                                <option value="herbal">ðŸŒ¿ Herbal</option>
                                <option value="crystal">ðŸ’Ž Crystal</option>
                                <option value="lunar">ðŸŒ™ Lunar</option>
                                <option value="philosophy">ðŸ“š Philosophy</option>
                                <option value="practice">âš¡ Practice</option>
                                <option value="synchronicity">âœ¨ Synchronicity</option>
                                <option value="personal">ðŸ’­ Personal</option>
                            </select>
                            
                            <div id="noteContentEditor" style="min-height: 150px; background: rgba(0, 0, 0, 0.3); border: 2px solid var(--mystic-purple); border-radius: 8px; margin-bottom: 12px;"></div>
                            
                            <button class="save-btn-compact" onclick="saveNote()" style="width: 100%;">ðŸ’¾ Save Note</button>
                        </div>

                        <!-- Notes Display -->
                        <div class="notes-compact" id="notesCompact">
                            <!-- Notes will be inserted here -->
                        </div>
                    </div>

                    <!-- Toolkit Tab -->
                    <div id="toolkitTabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸ› ï¸ Scribe's Toolkit</h3>
                        
                        <!-- Toolkit Sub-tabs -->
                        <div class="toolkit-subtabs">
                            <button class="toolkit-subtab active" onclick="switchToolkitTab('physical')">ðŸ›’ Physical</button>
                            <button class="toolkit-subtab" onclick="switchToolkitTab('digital')">ðŸ“± Digital</button>
                        </div>

                        <!-- Physical Tools -->
                        <div id="physicalToolkit" class="toolkit-subtab-content active">
                            <div class="progress-badge">
                                <span id="toolkitProgress">0 / 31</span> Items Acquired
                            </div>

                            <!-- Compact Checklist Categories -->
                            <div class="toolkit-categories">
                                <div class="toolkit-category-compact">
                                    <div class="category-header-compact" onclick="toggleCategory('studiolo')">
                                        ðŸ•¯ï¸ Studiolo Setup <span class="category-count" id="count-studiolo">(0/5)</span>
                                    </div>
                                    <div class="category-items" id="items-studiolo" style="display: none;">
                                        <div class="checklist-item-compact" data-category="studiolo" data-id="altar-cloth">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Altar Cloth (3 sections) <span class="price-tag">$15-30</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="studiolo" data-id="candles">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Candles (blue, white, gold) <span class="price-tag">$10-20</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="studiolo" data-id="incense">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Incense & Holder <span class="price-tag">$15-25</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="studiolo" data-id="bowls">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Offering Bowls (3) <span class="price-tag">$12-20</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="studiolo" data-id="statuary">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Deity Representations <span class="price-tag">$20-60</span></label>
                                        </div>
                                    </div>
                                </div>

                                <div class="toolkit-category-compact">
                                    <div class="category-header-compact" onclick="toggleCategory('herbal')">
                                        ðŸŒ¿ Herbal Practice <span class="category-count" id="count-herbal">(0/6)</span>
                                    </div>
                                    <div class="category-items" id="items-herbal" style="display: none;">
                                        <div class="checklist-item-compact" data-category="herbal" data-id="herbs">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Kitchen Herbs Starter Kit <span class="price-tag">$15-25</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="herbal" data-id="mortar">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Mortar & Pestle <span class="price-tag">$15-30</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="herbal" data-id="jars">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Glass Storage Jars (12-pack) <span class="price-tag">$20-35</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="herbal" data-id="infuser">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Tea Infuser/Strainer <span class="price-tag">$8-15</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="herbal" data-id="rack">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Herb Drying Rack <span class="price-tag">$15-25</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="herbal" data-id="labels">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Labels & Marker <span class="price-tag">$10</span></label>
                                        </div>
                                    </div>
                                </div>

                                <div class="toolkit-category-compact">
                                    <div class="category-header-compact" onclick="toggleCategory('crystal')">
                                        ðŸ’Ž Crystals & Minerals <span class="category-count" id="count-crystal">(0/6)</span>
                                    </div>
                                    <div class="category-items" id="items-crystal" style="display: none;">
                                        <div class="checklist-item-compact" data-category="crystal" data-id="beginner">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Beginner Crystal Set <span class="price-tag">$25-40</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="crystal" data-id="lapis">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Lapis Lazuli (Thoth) <span class="price-tag">$12-25</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="crystal" data-id="selenite">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Selenite (Ma'at) <span class="price-tag">$8-15</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="crystal" data-id="tigers">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Tiger's Eye (Caerus) <span class="price-tag">$8-15</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="crystal" data-id="display">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Display Box/Organizer <span class="price-tag">$15-30</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="crystal" data-id="bowl">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Cleansing Bowl <span class="price-tag">$10-20</span></label>
                                        </div>
                                    </div>
                                </div>

                                <div class="toolkit-category-compact">
                                    <div class="category-header-compact" onclick="toggleCategory('writing')">
                                        âœï¸ Writing Tools <span class="category-count" id="count-writing">(0/5)</span>
                                    </div>
                                    <div class="category-items" id="items-writing" style="display: none;">
                                        <div class="checklist-item-compact" data-category="writing" data-id="grimoire">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Physical Grimoire/Journal <span class="price-tag">$15-35</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="writing" data-id="pen">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Fountain Pen/Calligraphy Set <span class="price-tag">$20-40</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="writing" data-id="inks">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Colored Inks <span class="price-tag">$15-30</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="writing" data-id="wax">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Wax Seal Kit (optional) <span class="price-tag">$15-25</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="writing" data-id="bookmarks">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Bookmarks/Page Flags <span class="price-tag">$8-12</span></label>
                                        </div>
                                    </div>
                                </div>

                                <div class="toolkit-category-compact">
                                    <div class="category-header-compact" onclick="toggleCategory('lunar')">
                                        ðŸŒ™ Lunar & Timing <span class="category-count" id="count-lunar">(0/4)</span>
                                    </div>
                                    <div class="category-items" id="items-lunar" style="display: none;">
                                        <div class="checklist-item-compact" data-category="lunar" data-id="calendar">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Moon Phase Calendar <span class="price-tag">$12-20</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="lunar" data-id="hourglass">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Sand Timer/Hourglass (30min) <span class="price-tag">$15-25</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="lunar" data-id="jar">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Glass Jar for Moon Water <span class="price-tag">$8-15</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="lunar" data-id="chart">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Star Chart/Planisphere <span class="price-tag">$10-20</span></label>
                                        </div>
                                    </div>
                                </div>

                                <div class="toolkit-category-compact">
                                    <div class="category-header-compact" onclick="toggleCategory('protection')">
                                        ðŸ›¡ï¸ Protection Tools <span class="category-count" id="count-protection">(0/5)</span>
                                    </div>
                                    <div class="category-items" id="items-protection" style="display: none;">
                                        <div class="checklist-item-compact" data-category="protection" data-id="evil-eye">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Evil Eye Amulet <span class="price-tag">$10-25</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="protection" data-id="salt">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Sea Salt/Himalayan Salt <span class="price-tag">$5-12</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="protection" data-id="bell">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Cleansing Bell/Chime <span class="price-tag">$12-25</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="protection" data-id="nail">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Iron Nail (blessed) <span class="price-tag">$5-10</span></label>
                                        </div>
                                        <div class="checklist-item-compact" data-category="protection" data-id="water">
                                            <input type="checkbox" class="checkbox-compact" onchange="toggleToolkitCheck(this)">
                                            <label>Florida Water/Cleansing Spray <span class="price-tag">$8-15</span></label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Digital Tools -->
                        <div id="digitalToolkit" class="toolkit-subtab-content">
                            <div class="digital-apps">
                                <div class="app-compact">
                                    <div class="app-name-compact">âœ… Grit</div>
                                    <div class="app-desc-compact">Habit tracker â€¢ Currently using</div>
                                </div>
                                <div class="app-compact">
                                    <div class="app-name-compact">â±ï¸ Focus To-Do</div>
                                    <div class="app-desc-compact">Pomodoro timer â€¢ Currently using</div>
                                </div>
                                <div class="app-compact">
                                    <div class="app-name-compact">ðŸ“” Day One</div>
                                    <div class="app-desc-compact">Journaling â€¢ Currently using</div>
                                </div>
                                <div class="app-compact">
                                    <div class="app-name-compact">ðŸŒ™ Moon Phase Calendar</div>
                                    <div class="app-desc-compact">Track lunar cycles</div>
                                </div>
                                <div class="app-compact">
                                    <div class="app-name-compact">ðŸƒ Anki</div>
                                    <div class="app-desc-compact">Flashcards with spaced repetition</div>
                                </div>
                                <div class="app-compact">
                                    <div class="app-name-compact">ðŸ§˜ Insight Timer</div>
                                    <div class="app-desc-compact">Free meditation app</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Moon Tracker Tab -->
                    <div id="moonTabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸŒ™ Moon Tracker</h3>
                        
                        <div class="moon-tracker-card">
                            <!-- Current Moon Phase (Dynamic) -->
                            <div class="current-moon-phase">
                                <div class="moon-visual" id="moonVisual">
                                    <div class="moon-shadow" id="moonShadow"></div>
                                </div>
                                <div class="moon-phase-name" id="currentPhaseName">Calculating...</div>
                                <div class="moon-phase-date" id="currentPhaseDate"></div>
                                <div class="moon-illumination" id="moonIllumination"></div>
                            </div>
                            
                            <!-- Upcoming Moon Phases (Dynamic) -->
                            <div class="moon-calendar">
                                <h4 class="moon-section-header">ðŸ“… Upcoming Major Phases</h4>
                                <div class="moon-phases-list" id="upcomingPhases">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <!-- Current Phase Workings (Dynamic) -->
                            <div class="moon-workings">
                                <h4 class="moon-section-header">ðŸ“ Current Phase Guidance</h4>
                                <div id="phaseGuidance">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <!-- Days Until Next Phase -->
                            <div class="moon-countdown">
                                <h4 class="moon-section-header">â° Next Major Phase</h4>
                                <div class="countdown-display" id="nextPhaseCountdown">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Working Log Tab (Study Section) -->
                    <div id="workingLogTabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸŒ¿ Working Log</h3>
                        <div style="padding: 40px; text-align: center; color: var(--text-secondary);">
                            <p style="font-size: 1.2rem; margin-bottom: 20px;">ðŸ“ Working Log Coming Soon</p>
                            <p>Log your magical workings, track materials used, and document results.</p>
                        </div>
                    </div>

                    <!-- Sigil Generator Tab (Practice Section) -->
                    <div id="sigilGenTabContent" class="main-tab-content">
                        <h3 class="activity-title">âœ¨ Sigil Generator</h3>
                        <div style="padding: 40px; text-align: center; color: var(--text-secondary);">
                            <p style="font-size: 1.2rem; margin-bottom: 20px;">âœ¨ Sigil Generator Coming Soon</p>
                            <p>Create personalized sigils for your intentions.</p>
                        </div>
                    </div>

                    <!-- Esperanto Guide Tab (Practice Section) -->
                    <div id="esperantoTabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸ—£ï¸ Esperanto Guide</h3>
                        <div style="padding: 40px; text-align: center; color: var(--text-secondary);">
                            <p style="font-size: 1.2rem; margin-bottom: 20px;">ðŸ—£ï¸ Esperanto Guide Coming Soon</p>
                            <p>Learn Esperanto vocabulary and phrases for your practice.</p>
                        </div>
                    </div>

                    <!-- Progress Tab (You Section) -->
                    <div id="progressTabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸ“Š Your Progress & The Three Virtues</h3>
                        
                        <!-- Overall Stats -->
                        <div class="progress-overview">
                            <div class="progress-stat-card">
                                <div class="progress-stat-icon">ðŸ“š</div>
                                <div class="progress-stat-value">28</div>
                                <div class="progress-stat-label">Total Workings</div>
                            </div>
                            <div class="progress-stat-card">
                                <div class="progress-stat-icon">ðŸ”¥</div>
                                <div class="progress-stat-value">14</div>
                                <div class="progress-stat-label">Day Streak</div>
                            </div>
                            <div class="progress-stat-card">
                                <div class="progress-stat-icon">â­</div>
                                <div class="progress-stat-value">5</div>
                                <div class="progress-stat-label">Level</div>
                            </div>
                            <div class="progress-stat-card">
                                <div class="progress-stat-icon">âœ¨</div>
                                <div class="progress-stat-value">1,250</div>
                                <div class="progress-stat-label">Total XP</div>
                            </div>
                        </div>

                        <!-- Virtue Points Breakdown -->
                        <div class="virtue-breakdown">
                            <h4 class="progress-section-header">ðŸ”± Virtue Point Distribution</h4>
                            <div class="virtue-progress-list">
                                <div class="virtue-progress-item">
                                    <div class="virtue-progress-header">
                                        <span>ðŸŒ™ Thoth (Wisdom)</span>
                                        <span class="virtue-progress-rank">Journeyman â€¢ 420 pts</span>
                                    </div>
                                    <div class="virtue-progress-bar">
                                        <div class="virtue-progress-fill thoth" style="width: 68%"></div>
                                    </div>
                                </div>
                                <div class="virtue-progress-item">
                                    <div class="virtue-progress-header">
                                        <span>âš–ï¸ Ma'at (Balance)</span>
                                        <span class="virtue-progress-rank">Apprentice â€¢ 285 pts</span>
                                    </div>
                                    <div class="virtue-progress-bar">
                                        <div class="virtue-progress-fill maat" style="width: 45%"></div>
                                    </div>
                                </div>
                                <div class="virtue-progress-item">
                                    <div class="virtue-progress-header">
                                        <span>âš¡ Caerus (Timing)</span>
                                        <span class="virtue-progress-rank">Apprentice â€¢ 198 pts</span>
                                    </div>
                                    <div class="virtue-progress-bar">
                                        <div class="virtue-progress-fill caerus" style="width: 33%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Achievements -->
                        <div class="recent-achievements">
                            <h4 class="progress-section-header">ðŸ† Recent Achievements</h4>
                            <div class="achievement-list">
                                <div class="achievement-item">
                                    <span class="achievement-badge">ðŸŒ•</span>
                                    <div class="achievement-info">
                                        <div class="achievement-name">Full Moon Mastery</div>
                                        <div class="achievement-desc">Charged items under 3 consecutive full moons</div>
                                    </div>
                                </div>
                                <div class="achievement-item">
                                    <span class="achievement-badge">ðŸŒ¿</span>
                                    <div class="achievement-info">
                                        <div class="achievement-name">Herbalist Initiate</div>
                                        <div class="achievement-desc">Brewed 10 protective tisanes</div>
                                    </div>
                                </div>
                                <div class="achievement-item">
                                    <span class="achievement-badge">ðŸ“š</span>
                                    <div class="achievement-info">
                                        <div class="achievement-name">Dedicated Scholar</div>
                                        <div class="achievement-desc">Studied for 14 consecutive days</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Volume Styles (scoped for embedded volumes) -->
                    <style>
                        .volume-embed {
                            --void-black: #0a0514;
                            --deep-purple: #1a0f2e;
                            --mystic-purple: #2d1b4e;
                            --royal-purple: #4a2c6d;
                            --thoth-blue: #4a7dc7;
                            --maat-silver: #c0d0e8;
                            --caerus-gold: #daa520;
                            --mystic-glow: #8b6fd8;
                            --arcane-glow: #6ba3ff;
                            --gold-glow: #ffd700;
                            --text-primary: #e8f0ff;
                            --text-secondary: #a8b8d8;
                            font-family: 'Cormorant Garamond', serif;
                            color: var(--text-primary);
                            background: linear-gradient(135deg, var(--void-black), var(--deep-purple));
                            padding: 20px;
                            border-radius: 12px;
                            line-height: 1.8;
                        }

                        .volume-embed .volume-header {
                            text-align: center;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 2px solid var(--caerus-gold);
                            position: relative;
                        }

                        .volume-embed .volume-header::before,
                        .volume-embed .volume-header::after {
                            content: 'âœ¦';
                            position: absolute;
                            bottom: -12px;
                            font-size: 1.5rem;
                            color: var(--caerus-gold);
                            text-shadow: 0 0 10px var(--gold-glow);
                        }

                        .volume-embed .volume-header::before { left: 20px; }
                        .volume-embed .volume-header::after { right: 20px; }

                        .volume-embed .volume-number {
                            font-family: 'Cinzel', serif;
                            font-size: 1.1rem;
                            color: var(--caerus-gold);
                            letter-spacing: 3px;
                            margin-bottom: 8px;
                        }

                        .volume-embed .volume-title {
                            font-family: 'Cinzel', serif;
                            font-size: 2.3rem;
                            background: linear-gradient(135deg, var(--caerus-gold), var(--maat-silver));
                            -webkit-background-clip: text;
                            -webkit-text-fill-color: transparent;
                            background-clip: text;
                            margin-bottom: 12px;
                            text-shadow: 0 0 16px rgba(218, 165, 32, 0.35);
                        }

                        .volume-embed .trinity-symbols {
                            font-size: 1.8rem;
                            letter-spacing: 12px;
                            color: var(--maat-silver);
                            filter: drop-shadow(0 0 8px var(--arcane-glow));
                        }

                        .volume-embed .section {
                            background: linear-gradient(135deg, rgba(45, 27, 78, 0.6), rgba(74, 44, 109, 0.4));
                            border: 2px solid var(--thoth-blue);
                            border-radius: 15px;
                            padding: 24px;
                            margin-bottom: 24px;
                            box-shadow: 0 4px 18px rgba(74, 125, 199, 0.25), inset 0 0 26px rgba(74, 125, 199, 0.05);
                            position: relative;
                            overflow: hidden;
                        }

                        .volume-embed .section::before {
                            content: 'âœ¦';
                            position: absolute;
                            top: 12px;
                            right: 12px;
                            font-size: 1.4rem;
                            color: var(--caerus-gold);
                            opacity: 0.28;
                        }

                        .volume-embed .section-title {
                            font-family: 'Cinzel', serif;
                            font-size: 1.7rem;
                            color: var(--caerus-gold);
                            margin-bottom: 12px;
                            text-align: center;
                            text-shadow: 0 0 14px rgba(218, 165, 32, 0.45);
                        }

                        .volume-embed .section-subtitle {
                            text-align: center;
                            font-style: italic;
                            color: var(--maat-silver);
                            margin-bottom: 16px;
                            font-size: 1.05rem;
                        }

                        .volume-embed .deity-symbol { display: inline-block; font-size: 1.4rem; margin-right: 8px; }
                        .volume-embed .label { color: var(--caerus-gold); font-weight: 600; font-size: 1.05rem; }
                        .volume-embed .subsection-title { color: var(--thoth-blue); font-size: 1.25rem; margin: 18px 0 12px; font-weight: 600; }

                        .volume-embed ul { list-style: none; padding-left: 0; }
                        .volume-embed li { padding-left: 22px; position: relative; margin-bottom: 10px; }
                        .volume-embed ul li::before { content: 'âŸ¡'; position: absolute; left: 0; color: var(--thoth-blue); }

                        .volume-embed ol { padding-left: 0; list-style: none; counter-reset: item; }
                        .volume-embed ol li { padding-left: 28px; position: relative; margin-bottom: 12px; }
                        .volume-embed ol li::before { content: counter(item) '. '; counter-increment: item; position: absolute; left: 0; color: var(--caerus-gold); font-weight: 600; }

                        .volume-embed .framework-box,
                        .volume-embed .phase-box,
                        .volume-embed .timing-category,
                        .volume-embed .path-item,
                        .volume-embed .formula-step {
                            background: linear-gradient(135deg, rgba(10, 5, 20, 0.6), rgba(45, 27, 78, 0.4));
                            border: 2px solid var(--caerus-gold);
                            border-radius: 10px;
                            padding: 18px;
                            margin: 18px 0;
                            line-height: 1.7;
                        }

                        .volume-embed .framework-box { text-align: center; font-family: 'Courier New', monospace; font-size: 0.95rem; box-shadow: 0 0 18px rgba(218, 165, 32, 0.2); }
                        .volume-embed .framework-box .arrow { color: var(--caerus-gold); font-size: 1.1rem; }
                        .volume-embed .principle { background: linear-gradient(135deg, rgba(74, 44, 109, 0.4), rgba(45, 27, 78, 0.6)); border-left: 4px solid var(--thoth-blue); padding: 14px 18px; border-radius: 6px; margin: 18px 0; }
                        .volume-embed .studiolo-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 18px 0; padding: 16px; background: rgba(10, 5, 20, 0.4); border-radius: 10px; }
                        .volume-embed .studiolo-section { text-align: center; padding: 12px; background: linear-gradient(135deg, rgba(45, 27, 78, 0.6), rgba(74, 44, 109, 0.4)); border-radius: 10px; border: 1px solid var(--thoth-blue); }
                        .volume-embed .practice-item { background: linear-gradient(135deg, rgba(10, 5, 20, 0.6), rgba(45, 27, 78, 0.4)); padding: 14px; margin-bottom: 12px; border-left: 3px solid var(--thoth-blue); border-radius: 6px; }
                        .volume-embed .wip-notice { background: linear-gradient(135deg, rgba(74, 125, 199, 0.2), rgba(74, 44, 109, 0.2)); border: 2px dashed var(--thoth-blue); border-radius: 10px; padding: 24px; text-align: center; margin: 24px 0; }
                        .volume-embed .wip-icon { font-size: 2.6rem; margin-bottom: 12px; opacity: 0.65; }
                        .volume-embed .level-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin: 20px 0; }
                        .volume-embed .level-card { background: linear-gradient(135deg, rgba(10, 5, 20, 0.6), rgba(45, 27, 78, 0.5)); border: 2px solid var(--thoth-blue); border-radius: 10px; padding: 18px; text-align: center; }
                        .volume-embed .level-icon { font-size: 2.3rem; margin-bottom: 12px; filter: drop-shadow(0 0 10px var(--caerus-gold)); }
                        .volume-embed .level-title { font-family: 'Cinzel', serif; font-size: 1.35rem; color: var(--caerus-gold); margin-bottom: 12px; }
                        .volume-embed .level-content { font-size: 0.95rem; line-height: 1.6; color: var(--text-secondary); text-align: left; }

                        .volume-embed::-webkit-scrollbar { width: 10px; }
                        .volume-embed::-webkit-scrollbar-track { background: var(--deep-purple); }
                        .volume-embed::-webkit-scrollbar-thumb { background: var(--royal-purple); border-radius: 5px; }
                        .volume-embed::-webkit-scrollbar-thumb:hover { background: var(--mystic-purple); }

                        @media (max-width: 768px) {
                            .volume-embed .volume-title { font-size: 2rem; }
                            .volume-embed .section { padding: 18px; }
                            .volume-embed .studiolo-grid { grid-template-columns: 1fr; }
                        }
                    </style>

                    <!-- Volume I Tab (Volumes Section) -->
                    <div id="volume1TabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸ“– Volume I: The Three Virtues</h3>
                        <div class="volume-content">
                            <div class="volume-embed">
                                <div class="volume-header">
                                    <div class="volume-number">VOLUME I</div>
                                    <h1 class="volume-title">The Three Virtues</h1>
                                    <div class="trinity-symbols">ðŸŒ™ âš–ï¸ âš¡</div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title"><span class="deity-symbol">ðŸŒ™</span> THOTH - Patron of Scribes</h2>
                                    <p class="section-subtitle">Ancient Egyptian deity of the Moon</p>
                                    
                                    <p style="margin-bottom: 15px;"><span class="label">Domains of Influence:</span> Lunar cycles, accumulated wisdom, systems of writing, sacred geometry, natural philosophy, the scribal arts, measurement and calculation</p>
                                    
                                    <p style="margin-bottom: 15px;"><span class="label">Role in Studies:</span> Provides the methodologies and accumulated knowledge of those who came before</p>
                                    
                                    <p class="label" style="margin-bottom: 10px;">Shrine Correspondences:</p>
                                    <ul>
                                        <li>Lunar calendars and astronomical charts</li>
                                        <li>Manuscripts and scrolls</li>
                                        <li>Quills, inks, and wax tablets</li>
                                        <li>Blue lapis lazuli, silver objects</li>
                                        <li>Ibis feathers</li>
                                    </ul>
                                </div>

                                <div class="section">
                                    <h2 class="section-title"><span class="deity-symbol">âš–ï¸</span> MA'AT - The Eternal Balance</h2>
                                    <p class="section-subtitle">Ancient Egyptian goddess of Cosmic Order</p>
                                    
                                    <p style="margin-bottom: 15px;"><span class="label">Domains of Influence:</span> Veritas (truth), equilibrium, natural law, cosmic harmony, jurisprudence, ethical philosophy</p>
                                    
                                    <p style="margin-bottom: 15px;"><span class="label">Role in Studies:</span> Provides the ethical framework and natural order within which all work must occur</p>
                                    
                                    <p class="label" style="margin-bottom: 10px;">Shrine Correspondences:</p>
                                    <ul>
                                        <li>Ostrich feather (symbol of truth)</li>
                                        <li>Brass scales or balance</li>
                                        <li>White linen cloth</li>
                                        <li>Gold leaf or gilding</li>
                                        <li>Geometric patterns showing symmetry</li>
                                    </ul>
                                    
                                    <p style="margin-top: 20px;"><span class="label">Opposing Force:</span> <em>Isfet</em> - chaos, disorder, violence against natural law</p>
                                </div>

                                <div class="section">
                                    <h2 class="section-title"><span class="deity-symbol">âš¡</span> CAERUS - The Fleeting Moment</h2>
                                    <p class="section-subtitle">Greek daimon of Opportunity</p>
                                    
                                    <p style="margin-bottom: 15px;"><span class="label">Domains of Influence:</span> Favorable moments, propitious timing, fortuna's window, the seized instant</p>
                                    
                                    <p style="margin-bottom: 15px;"><span class="label">Role in Studies:</span> Reveals through observation when conditions align for successful work</p>
                                    
                                    <p class="label" style="margin-bottom: 10px;">Shrine Correspondences:</p>
                                    <ul>
                                        <li>Sharp instruments (razor, knife balanced on edge)</li>
                                        <li>Brass scales tipping</li>
                                        <li>Feathers or representations of wings</li>
                                        <li>Water clocks or sand glasses</li>
                                        <li>Quicksilver (mercury) if available</li>
                                        <li>Objects that move (spinning tops, pendulums)</li>
                                    </ul>
                                    
                                    <p style="margin-top: 20px;"><span class="label">Nature:</span> Invisible save through consequences; depicted with wings upon feet, running always upon toes, with forelock to grasp but bald behindâ€”once passed, impossible to seize</p>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">ðŸ”º The Philosophical Framework</h2>
                                    <h3 class="section-subtitle">The Triadic Process of Right Action</h3>
                                    
                                    <div class="framework-box">
                                        QUESTION arises <span class="arrow">â†’</span> THOTH provides knowledge through study<br>
                                        <span class="arrow">â†“</span><br>
                                        KNOWLEDGE applied <span class="arrow">â†’</span> MA'AT ensures ethical balance<br>
                                        <span class="arrow">â†“</span><br>
                                        ACTION executed <span class="arrow">â†’</span> CAERUS determines propitious timing
                                    </div>
                                    
                                    <div class="principle">
                                        <span class="label">FUNDAMENTAL PRINCIPLE:</span> The scribe does not command forces but rather <em>observes and cooperates</em> with the natural order (Ma'at) using accumulated knowledge (Thoth) when conditions align (Caerus).
                                    </div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">ðŸ•¯ï¸ Construction of the Household Studiolo</h2>
                                    <p style="margin-bottom: 20px;">Establish a three-part studiolo upon a sturdy table or shelf:</p>
                                    
                                    <div class="studiolo-grid">
                                        <div class="studiolo-section">
                                            <span class="label">ðŸŒ™ THOTH'S QUARTER</span>
                                            <div>
                                                Lunar charts<br>
                                                Manuscripts<br>
                                                Quill & ink<br>
                                                Lapis or blue stone
                                            </div>
                                        </div>
                                        
                                        <div class="studiolo-section">
                                            <span class="label">âš–ï¸ MA'AT'S QUARTER</span>
                                            <div>
                                                Feather & scales<br>
                                                White cloth<br>
                                                Gold/brass objects<br>
                                                Symmetrical designs
                                            </div>
                                        </div>
                                        
                                        <div class="studiolo-section">
                                            <span class="label">âš¡ CAERUS'S QUARTER</span>
                                            <div>
                                                Sharp blade on edge<br>
                                                Sand glass<br>
                                                Silver bowl with water<br>
                                                Winged imagery
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <p style="margin-top: 20px;"><span class="label">Maintenance:</span> Cleanse weekly or when energies feel disordered. Keep writing implements sharp and ready.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Volume II Tab (Volumes Section) -->
                    <div id="volume2TabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸ“– Volume II: Daily Workings</h3>
                        <div class="volume-content">
                            <div class="volume-embed">
                                <div class="volume-header">
                                    <div class="volume-number">VOLUME II</div>
                                    <h1 class="volume-title">Daily Workings</h1>
                                    <div class="trinity-symbols">ðŸŒ™ âš–ï¸ âš¡</div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">ðŸ›¡ï¸ Apotropaic Practices</h2>
                                    <p class="section-subtitle">The Art of Protection</p>
                                    
                                    <h3 class="subsection-title">Active Protections:</h3>
                                    <ul style="margin-bottom: 20px;">
                                        <li><strong>Evil Eye Talisman</strong> - Painted eye symbol on ceramic or carved wood, worn or placed upon studiolo</li>
                                        <li><strong>Knocking Wood Thrice</strong> - Physical gesture for grounding and attracting favorable fortune</li>
                                        <li><strong>Dual-Purpose Iron</strong> - Kitchen knife blessed at hearth for both nourishment and protection of household</li>
                                    </ul>
                                    
                                    <p><span class="label">Philosophical Foundation (Egyptian Heka):</span><br>
                                    Natural philosophy applied solely for healing and protection, never for harm. Working with herbs, minerals, waters, and spoken formulae.</p>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">ðŸ“– Standard Process for Studies</h2>
                                    <p class="section-subtitle">For Protection or Healing Work</p>
                                    
                                    <div class="phase-box">
                                        <p style="margin-bottom: 15px;"><span class="label">PHASE I - Grounding (Ma'at)</span><br>
                                        State clearly your intention. Ensure it serves balance, not vengeance. Align with natural law.</p>
                                        
                                        <p style="margin-bottom: 15px;"><span class="label">PHASE II - Research (Thoth)</span><br>
                                        Consult texts on natural correspondences. Study the herb, stone, or method. Document observations. Consider moon phase, season, planetary hour.</p>
                                        
                                        <p style="margin-bottom: 15px;"><span class="label">PHASE III - Observation of Timing (Caerus)</span><br>
                                        Wait until external signs align with internal readiness. Do not force against nature's rhythm.</p>
                                        
                                        <p style="margin-bottom: 15px;"><span class="label">PHASE IV - Execution</span><br>
                                        Perform the work: brew the tisane, construct the amulet, speak the formula, inscribe the talisman.</p>
                                        
                                        <p><span class="label">PHASE V - Sealing</span><br>
                                        Knock thrice upon wood, or place the working upon your shrine with spoken acknowledgment.</p>
                                    </div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">ðŸŒ¿ Daily Observances for the Scribe</h2>
                                    <h3 class="subsection-title">Regular Practices:</h3>
                                    
                                    <div class="practice-item">
                                        <span class="label">Charging Talismans</span><br>
                                        Hold object whilst concentrating intention. The focused will imprints upon matter.
                                    </div>
                                    
                                    <div class="practice-item">
                                        <span class="label">Brewing Medicinal Tisanes</span><br>
                                        The preparation itself constitutes the working. Stir deosil (clockwise) while holding intent.
                                    </div>
                                    
                                    <div class="practice-item">
                                        <span class="label">Inscribing Symbols</span><br>
                                        Egyptian hieroglyphs or sacred geometry. The act of writing channels Thoth's influence.
                                    </div>
                                    
                                    <div class="practice-item">
                                        <span class="label">Arranging Studiolo Objects</span><br>
                                        Placement communicates with divine forces. Intentional arrangement = prayer without words.
                                    </div>
                                    
                                    <div class="practice-item">
                                        <span class="label">Offline Study</span> <em>(formerly meditation)</em><br>
                                        Silent contemplation before images of the Three Virtues. Observation of breath and thought.
                                    </div>
                                    
                                    <div class="practice-item">
                                        <span class="label">Written Intentions</span><br>
                                        Inscribe upon parchment, then burn (element of fire), bury (element of earth), or place upon studiolo. Most aligned with Thoth's nature.
                                    </div>
                                    
                                    <div class="practice-item">
                                        <span class="label">Symbolic Gestures</span><br>
                                        Stirring deosil, specific number of knocks, hand positions during invocation.
                                    </div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">ðŸ’§ðŸ”” Methods of Purification</h2>
                                    
                                    <h3 class="subsection-title">ðŸ’§ Water-Based Cleansing</h3>
                                    
                                    <div class="practice-item">
                                        <span class="label">ðŸŒ• Lunar Water (Thoth-aligned)</span>
                                        <ul style="margin-top: 10px;">
                                            <li>Expose vessel of water to full or new moon overnight</li>
                                            <li>Use for wiping studiolo, washing hands before studies, anointing objects</li>
                                            <li>Effective for one lunar cycle if kept in sealed glass vessel</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="practice-item">
                                        <span class="label">ðŸ§‚ Salt Water (Ma'at-aligned)</span>
                                        <ul style="margin-top: 10px;">
                                            <li>Dissolve sea salt in spring water</li>
                                            <li>Employ for heavier purifications (after difficult work, monthly renewal)</li>
                                            <li>Do not apply to iron or bronze objects (causes corrosion)</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="practice-item">
                                        <span class="label">ðŸš° Common Well Water</span>
                                        <ul style="margin-top: 10px;">
                                            <li>Set intention whilst washing hands in flowing water</li>
                                            <li>"Washing away" functions both literally and metaphysically</li>
                                            <li>Quick daily reset</li>
                                        </ul>
                                    </div>
                                    
                                    <h3 class="subsection-title">ðŸ”” Sound-Based Cleansing</h3>
                                    
                                    <div class="practice-item">
                                        <span class="label">ðŸ”” Bell or Chime</span>
                                        <ul style="margin-top: 10px;">
                                            <li>Ring thrice (at threshold, center, and far end of space)</li>
                                            <li>Sound vibration disrupts stagnant energies</li>
                                            <li>Effective between successive workings</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="practice-item">
                                        <span class="label">ðŸŽµ Singing Bowl (if available)</span>
                                        <ul style="margin-top: 10px;">
                                            <li>Sustain tone whilst moving about space</li>
                                            <li>Vibration resets the subtle field</li>
                                            <li>More contemplative, thorough purification</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="practice-item">
                                        <span class="label">ðŸ‘ Clapping or Snapping</span>
                                        <ul style="margin-top: 10px;">
                                            <li>Requires no instruments</li>
                                            <li>Sharp sounds directed into corners and over shrine</li>
                                            <li>Always available</li>
                                        </ul>
                                    </div>
                                    
                                    <h3 class="subsection-title">ðŸŒŠ Combined Method</h3>
                                    
                                    <p><span class="label">Simple Process:</span></p>
                                    <ol style="margin-top: 10px; margin-bottom: 20px;">
                                        <li>Sound cleansing (bell or clapping) to clear space</li>
                                        <li>Water cleansing (wash hands or wipe studiolo) to reset physical plane</li>
                                        <li>Three knocks to seal the purification</li>
                                    </ol>
                                    
                                    <p><span class="label">When to Purify:</span></p>
                                    <ul style="margin-top: 10px;">
                                        <li>Before significant workings</li>
                                        <li>Weekly studiolo maintenance</li>
                                        <li>After disturbances or ill fortune</li>
                                        <li>At new and full moon</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Volume III Tab (Volumes Section) -->
                    <div id="volume3TabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸ“– Volume III: Scroll Workings</h3>
                        <div class="volume-content">
                            <div class="volume-embed">
                                <div class="volume-header">
                                    <div class="volume-number">VOLUME III</div>
                                    <h1 class="volume-title">Scroll Workings</h1>
                                    <div class="trinity-symbols">ðŸŒ™ âš–ï¸ âš¡</div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">Advanced Spell Workings</h2>
                                    <p class="section-subtitle">Organized by Practitioner Level</p>
                                    <p style="text-align: center;">This volume contains detailed spell workings for protection, healing, purification, and empowerment, organized into three levels of practice: Apprentice, Journeyman, and Master.</p>
                                </div>

                                <div class="wip-notice">
                                    <div class="wip-icon">ðŸ“œ</div>
                                    <h3 style="color: var(--caerus-gold); margin-bottom: 15px; font-family: 'Cinzel', serif;">Grimoire in Progress</h3>
                                    <p style="color: var(--maat-silver); font-size: 1.1rem;">
                                        This volume is currently being compiled and expanded.<br>
                                        Detailed workings for each practitioner level are forthcoming.
                                    </p>
                                </div>

                                <div class="level-grid">
                                    <div class="level-card">
                                        <div class="level-icon">ðŸŒ±</div>
                                        <h3 class="level-title">Apprentice Workings</h3>
                                        <p class="level-content">
                                            Simple rituals for protection, healing, and harmony suitable for beginning practitioners. Uses accessible materials like kitchen herbs and common crystals.
                                        </p>
                                    </div>

                                    <div class="level-card">
                                        <div class="level-icon">ðŸ”¬</div>
                                        <h3 class="level-title">Journeyman Workings</h3>
                                        <p class="level-content">
                                            Advanced protection, purification, release rituals, and divination practices requiring established practice and deeper understanding.
                                        </p>
                                    </div>

                                    <div class="level-card">
                                        <div class="level-icon">ðŸŽ“</div>
                                        <h3 class="level-title">Master Workings</h3>
                                        <p class="level-content">
                                            Complex transformation, manifestation, advanced divination, and ritual celebrations for experienced practitioners.
                                        </p>
                                    </div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">Documentation Protocol</h2>
                                    <p class="label" style="margin-bottom: 15px;">Record your workings using this framework:</p>
                                    <ul>
                                        <li>Date & Time</li>
                                        <li>Moon Phase</li>
                                        <li>Planetary Day</li>
                                        <li>Working Name</li>
                                        <li>Intention Stated</li>
                                        <li>Materials Used</li>
                                        <li>Process Notes</li>
                                        <li>Immediate Results</li>
                                        <li>Follow-up (7 days & 30 days)</li>
                                        <li>Lessons Learned</li>
                                    </ul>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">Planned Content Structure</h2>
                                    
                                    <div style="background: linear-gradient(135deg, rgba(10, 5, 20, 0.6), rgba(45, 27, 78, 0.4)); padding: 20px; margin: 20px 0; border-left: 4px solid var(--caerus-gold); border-radius: 5px;">
                                        <span class="label">Protection Workings</span><br>
                                        <span style="color: var(--text-secondary);">Warding, shielding, banishing, boundary-setting</span>
                                    </div>
                                    
                                    <div style="background: linear-gradient(135deg, rgba(10, 5, 20, 0.6), rgba(45, 27, 78, 0.4)); padding: 20px; margin: 20px 0; border-left: 4px solid var(--caerus-gold); border-radius: 5px;">
                                        <span class="label">Healing Workings</span><br>
                                        <span style="color: var(--text-secondary);">Physical wellness, emotional balance, energy restoration</span>
                                    </div>
                                    
                                    <div style="background: linear-gradient(135deg, rgba(10, 5, 20, 0.6), rgba(45, 27, 78, 0.4)); padding: 20px; margin: 20px 0; border-left: 4px solid var(--caerus-gold); border-radius: 5px;">
                                        <span class="label">Purification Workings</span><br>
                                        <span style="color: var(--text-secondary);">Space cleansing, object consecration, personal purification</span>
                                    </div>
                                    
                                    <div style="background: linear-gradient(135deg, rgba(10, 5, 20, 0.6), rgba(45, 27, 78, 0.4)); padding: 20px; margin: 20px 0; border-left: 4px solid var(--caerus-gold); border-radius: 5px;">
                                        <span class="label">Study Enhancement</span><br>
                                        <span style="color: var(--text-secondary);">Focus, memory, clarity, wisdom-seeking</span>
                                    </div>
                                    
                                    <div style="background: linear-gradient(135deg, rgba(10, 5, 20, 0.6), rgba(45, 27, 78, 0.4)); padding: 20px; margin: 20px 0; border-left: 4px solid var(--caerus-gold); border-radius: 5px;">
                                        <span class="label">Manifestation Workings</span><br>
                                        <span style="color: var(--text-secondary);">Drawing opportunities, aligning with Caerus, intention-setting</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Volume IV Tab (Volumes Section) -->
                    <div id="volume4TabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸ“– Volume IV: Lunar Practice & Timing</h3>
                        <div class="volume-content">
                            <div class="volume-embed">
                                <div class="volume-header">
                                    <div class="volume-number">VOLUME IV</div>
                                    <h1 class="volume-title">Lunar Practice & Timing</h1>
                                    <div class="trinity-symbols">ðŸŒ™ âš–ï¸ âš¡</div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">âš¡ Understanding Caerus</h2>
                                    <p class="section-subtitle">A Practical Treatise on Timing</p>
                                    
                                    <h3 class="subsection-title">The Fundamental Question</h3>
                                    <p style="margin-bottom: 20px;">Caerus asks: "Does this feel <em>right</em> to execute <em>now</em>?"</p>
                                    
                                    <p class="label" style="margin-bottom: 10px;">His symbols reveal his nature:</p>
                                    <ul>
                                        <li><strong>Razor's edge</strong> = The precise instant between too soon and too late</li>
                                        <li><strong>Running on toes</strong> = The moment passes swiftly</li>
                                        <li><strong>Wings on feet</strong> = Opportunity flies away</li>
                                        <li><strong>Forelock to grasp</strong> = You must seize it as it approaches</li>
                                        <li><strong>Bald behind</strong> = Once passed, nothing remains to hold</li>
                                    </ul>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">ðŸŽ¯ Three Degrees of Timing</h2>
                                    
                                    <h3 class="subsection-title">Degree I: External Timing (Most Learnable)</h3>
                                    <p style="margin-bottom: 20px;">These cycles are predictable and observable:</p>
                                    
                                    <div class="timing-category">
                                        <span class="label">ðŸŒ™ Lunar Phases</span>
                                        <ul style="margin-top: 15px;">
                                            <li><strong>New Moon ðŸŒ‘</strong> - Initiation of new workings, planting intentions, fresh beginnings</li>
                                            <li><strong>Waxing Moon ðŸŒ“</strong> - Growth, accumulation, attraction, building power</li>
                                            <li><strong>Full Moon ðŸŒ•</strong> - Peak potency, culmination, charging talismans</li>
                                            <li><strong>Waning Moon ðŸŒ—</strong> - Release, banishing, purification, diminishment</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="timing-category">
                                        <span class="label">ðŸ“… Days of the Week (Planetary Hours)</span>
                                        <ul style="margin-top: 15px;">
                                            <li><strong>Monday (Luna) ðŸŒ™</strong> - Thoth's work: wisdom-seeking, divination, dream work, intuition</li>
                                            <li><strong>Tuesday (Mars) â™‚ï¸</strong> - Protection, courage, conflict resolution, martial vigor</li>
                                            <li><strong>Wednesday (Mercury) â˜¿ï¸</strong> - Communication, learning, swift workings, travel safety</li>
                                            <li><strong>Thursday (Jupiter) â™ƒ</strong> - Prosperity, expansion, justice (Ma'at-aligned), growth</li>
                                            <li><strong>Friday (Venus) â™€ï¸</strong> - Healing, harmony, beauty, relationship matters</li>
                                            <li><strong>Saturday (Saturn) â™„</strong> - Banishing, binding, endings, setting boundaries</li>
                                            <li><strong>Sunday (Sol) â˜‰</strong> - General power, health, success, vitality</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="timing-category">
                                        <span class="label">ðŸ‚ Seasonal Correspondences</span>
                                        <ul style="margin-top: 15px;">
                                            <li><strong>Spring ðŸŒ¸</strong> - Growth workings, new endeavors, planting seeds</li>
                                            <li><strong>Summer â˜€ï¸</strong> - Peak energy work, abundance, maximum solar power</li>
                                            <li><strong>Autumn ðŸ</strong> - Harvest of results, gratitude, reflection, preparation</li>
                                            <li><strong>Winter â„ï¸</strong> - Rest, planning, protection, internal work</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="timing-category">
                                        <span class="label">â° Hours of the Day</span>
                                        <ul style="margin-top: 15px;">
                                            <li><strong>Dawn ðŸŒ…</strong> - New beginnings, clarity, hope</li>
                                            <li><strong>Noon â˜€ï¸</strong> - Maximum power, peak solar energy</li>
                                            <li><strong>Dusk ðŸŒ‡</strong> - Transitions, release, closure</li>
                                            <li><strong>Midnight ðŸŒ™</strong> - Deep workings, hidden knowledge, psychic enhancement</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="section">
                                    <h3 class="subsection-title">Degree II: Internal Timing (Requires Self-Knowledge)</h3>
                                    <p style="margin-bottom: 15px;">This concerns the scribe's own readiness:</p>
                                    
                                    <p class="label" style="margin-bottom: 10px;">Questions for Discernment:</p>
                                    <ul style="margin-bottom: 20px;">
                                        <li>Have I the energy and focus presently?</li>
                                        <li>Are all materials assembled and prepared?</li>
                                        <li>Does this demand immediate action or may it wait?</li>
                                        <li>Am I in proper mental and spiritual condition?</li>
                                    </ul>
                                    
                                    <p>If any answer is negative â†’ <span class="label">Wait.</span> This is Caerus saying "not yet."</p>
                                </div>

                                <div class="section">
                                    <h3 class="subsection-title">Degree III: Synchronistic Timing (Advanced Practice)</h3>
                                    <p style="margin-bottom: 15px;">This is Caerus arriving unbidden:</p>
                                    
                                    <p class="label" style="margin-bottom: 10px;">Manifestations:</p>
                                    <ul style="margin-bottom: 20px;">
                                        <li>Whilst contemplating a protection working, someone gifts you rosemary without knowing your need</li>
                                        <li>Information about a specific herb appears thrice in a single day through different sources</li>
                                        <li>Strong compulsion to act immediately without logical cause</li>
                                        <li>All required materials appear simultaneously without seeking</li>
                                    </ul>
                                    
                                    <p>This is the <span class="label">razor's edge moment</span> â†’ Act swiftly or it passes forever</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Volume V Tab (Volumes Section) -->
                    <div id="volume5TabContent" class="main-tab-content">
                        <h3 class="activity-title">ðŸ“– Volume V: Reference & Study</h3>
                        <div class="volume-content">
                            <div class="volume-embed">
                                <div class="volume-header">
                                    <div class="volume-number">VOLUME V</div>
                                    <h1 class="volume-title">Reference & Study</h1>
                                    <div class="trinity-symbols">ðŸŒ™ âš–ï¸ âš¡</div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">ðŸ“š The Scribe's Course of Study</h2>
                                    <p class="section-subtitle">Natural Philosophy as Foundation</p>
                                    
                                    <div class="level-grid">
                                        <div class="level-card">
                                            <div class="level-icon">ðŸŒ±</div>
                                            <h3 class="level-title">Apprentice Level</h3>
                                            <div class="level-content">
                                                <strong>Herbal Philosophy:</strong> Study Materia Medica - properties of common herbs, roots, flowers. Begin with kitchen herbs: rosemary, sage, thyme, mint.<br><br>
                                                <strong>Lunar Astronomy:</strong> Track moon phases through direct observation.<br><br>
                                                <strong>Basic Alchemical Principles:</strong> Understand the four elements and four humors.
                                            </div>
                                        </div>
                                        
                                        <div class="level-card">
                                            <div class="level-icon">ðŸ”¬</div>
                                            <h3 class="level-title">Journeyman Level</h3>
                                            <div class="level-content">
                                                <strong>Magia Naturalis Study:</strong> Natural magic through understanding hidden properties of nature.<br><br>
                                                <strong>Seasonal Correspondences:</strong> Observe Ma'at's order through seasons.<br><br>
                                                <strong>Timing Techniques:</strong> Planetary hours, moon in zodiacal signs, propitious days.
                                            </div>
                                        </div>
                                        
                                        <div class="level-card">
                                            <div class="level-icon">ðŸŽ“</div>
                                            <h3 class="level-title">Master Level</h3>
                                            <div class="level-content">
                                                <strong>Alchemical Philosophy:</strong> Study of transformation and perfection.<br><br>
                                                <strong>Advanced Astronomical Timing:</strong> Precise calculations using astrolabe or armillary sphere.<br><br>
                                                <strong>Botanical Mastery:</strong> Cultivate physic garden. Grow, harvest, and preserve materials.
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">ðŸ”€ The Three Paths of Natural Philosophy</h2>
                                    <p style="margin-bottom: 20px;">These disciplines inform and strengthen one another:</p>
                                    
                                    <div class="path-item">
                                        <span class="label">â­ Astrologia â†’ ðŸ”­ Astronomia</span><br>
                                        Understanding celestial influences and precise timing through observation and calculation
                                    </div>
                                    
                                    <div class="path-item">
                                        <span class="label">ðŸœƒ Alchemia â†’ âš—ï¸ Natural Sciences</span><br>
                                        Understanding transformation, purification, and material properties through experiment
                                    </div>
                                    
                                    <div class="path-item">
                                        <span class="label">ðŸŒ¿ Herbalism â†’ ðŸŒ± Botanical Philosophy</span><br>
                                        Understanding plant virtues and applications through cultivation and documentation
                                    </div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">âš¡ Simplified Process Formula</h2>
                                    
                                    <div class="formula-step">
                                        <span class="label">I. Identification</span><br>
                                        Recognize the need (protection required, healing sought)
                                    </div>
                                    
                                    <div class="formula-step">
                                        <span class="label">II. Investigation</span><br>
                                        Research natural correspondences through texts and observation
                                    </div>
                                    
                                    <div class="formula-step">
                                        <span class="label">III. Preparation</span><br>
                                        Gather materials during astronomically favorable period
                                    </div>
                                    
                                    <div class="formula-step">
                                        <span class="label">IV. Invocation</span><br>
                                        Speak formula or maintain focused intention
                                    </div>
                                    
                                    <div class="formula-step">
                                        <span class="label">V. Documentation</span><br>
                                        Record process, materials, timing, and results in your grimoire
                                    </div>
                                </div>

                                <div class="section">
                                    <h2 class="section-title">ðŸš€ Initiation for the New Scribe</h2>
                                    <p class="label" style="margin-bottom: 20px;">First Steps:</p>
                                    
                                    <ol>
                                        <li><strong>Establish your three-part shrine this day</strong><br>
                                        Begin modestly. Even a shelf with three divisions suffices.</li>
                                        
                                        <li><strong>Select one apotropaic talisman to carry</strong><br>
                                        Evil eye painted on wood, protective herb in cloth pouch, iron nail blessed at your hearth.</li>
                                        
                                        <li><strong>Study one herb for a specific purpose</strong><br>
                                        Begin with what grows nearby. Consult available texts. Make direct observations.</li>
                                        
                                        <li><strong>Await the new or full moon for your first working</strong><br>
                                        Patience is part of the study. Use intervening time for research and preparation.</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Modals and overlays below -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3 class="footer-title">ðŸ“œ Grimorio Emperia</h3>
                <p class="footer-subtitle">Libellus Trium Virtutum</p>
                <p class="footer-tagline">Empirical Philosophy Through Natural Law</p>
            </div>
            
            <div class="footer-section">
                <h4 class="footer-heading">Quick Links</h4>
                <ul class="footer-links">
                    <li><a href="volumes/volume1.html">The Three Virtues</a></li>
                    <li><a href="volumes/volume2.html">Daily Workings</a></li>
                    <li><a href="volumes/volume4.html">Lunar Practice</a></li>
                    <li><a href="volumes/volume5.html">Reference</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h4 class="footer-heading">Return to Hub</h4>
                <a href="https://shieldsofrosaria.github.io/grimly/" class="hub-link" target="_blank">
                    â† Back to Grimly Main Hub
                </a>
                <p class="footer-note">Part of the Grimly Web App Collection</p>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="trinity-symbols">ðŸŒ™ âš–ï¸ âš¡</div>
            <p class="footer-motto">Amo Ä‰iujn, fidu malmultajn, difektu neniun</p>
            <p class="footer-copyright">Lord Edmund Ashford's Empirical Grimoire â€¢ 2025</p>
        </div>
    </footer>

    <!-- Profile Edit Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeProfileModal()">Ã—</span>
            
            <div class="modal-header">
                <h2 class="modal-title">âš¡ Edit Scribe Profile âš¡</h2>
                <p style="color: var(--text-secondary); font-style: italic;">Customize your empirical journey</p>
            </div>

            <form id="profileForm" onsubmit="saveProfile(event)">
                <div class="avatar-upload-section">
                    <div class="avatar-preview" id="avatarPreview">
                        ðŸ“œ
                    </div>
                    <input type="file" id="avatarFileInput" accept="image/*" onchange="uploadAvatar(event)">
                    <button type="button" class="upload-btn" id="uploadBtn" onclick="document.getElementById('avatarFileInput').click()">
                        ðŸ“· Upload Custom Avatar
                    </button>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary); font-style: italic;">
                        Or choose an emoji below
                    </p>
                </div>

                <div class="form-group">
                    <label class="form-label">ðŸŽ­ Emoji Avatar</label>
                    <div class="avatar-picker" id="avatarPicker">
                        <div class="avatar-option" data-avatar="ðŸ“œ" data-type="emoji">ðŸ“œ</div>
                        <div class="avatar-option" data-avatar="ðŸŒ™" data-type="emoji">ðŸŒ™</div>
                        <div class="avatar-option" data-avatar="âš¡" data-type="emoji">âš¡</div>
                        <div class="avatar-option" data-avatar="âš–ï¸" data-type="emoji">âš–ï¸</div>
                        <div class="avatar-option" data-avatar="ðŸ”®" data-type="emoji">ðŸ”®</div>
                        <div class="avatar-option" data-avatar="âœ¨" data-type="emoji">âœ¨</div>
                        <div class="avatar-option" data-avatar="ðŸŒ¿" data-type="emoji">ðŸŒ¿</div>
                        <div class="avatar-option" data-avatar="ðŸ•¯ï¸" data-type="emoji">ðŸ•¯ï¸</div>
                        <div class="avatar-option" data-avatar="ðŸ“–" data-type="emoji">ðŸ“–</div>
                        <div class="avatar-option" data-avatar="ðŸ—ï¸" data-type="emoji">ðŸ—ï¸</div>
                        <div class="avatar-option" data-avatar="â­" data-type="emoji">â­</div>
                        <div class="avatar-option" data-avatar="ðŸ¦‰" data-type="emoji">ðŸ¦‰</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">âœŽ Scribe Name</label>
                    <input type="text" class="form-input" id="nameInput" placeholder="Enter your scribe name..." required>
                </div>

                <div class="form-group">
                    <label class="form-label">ðŸ“œ Rank/Title</label>
                    <input type="text" class="form-input" id="rankInput" placeholder="e.g., Apprentice Scribe, Journeyman Scholar...">
                </div>

                <div class="form-group">
                    <label class="form-label">ðŸ“Š Current Level</label>
                    <input type="number" class="form-input" id="levelInput" min="1" max="100" value="5">
                </div>

                <button type="submit" class="save-btn">ðŸ’¾ Save Profile</button>
            </form>
        </div>
    </div>

    <!-- Cloud Sync Modal -->
    <div id="syncModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeSyncModal()">Ã—</span>
            
            <div class="modal-header">
                <h2 class="modal-title">â˜ï¸ Cloud Sync Settings â˜ï¸</h2>
                <p style="color: var(--text-secondary); font-style: italic;">Sync your profile across devices</p>
            </div>

            <!-- Sync Tabs -->
            <div class="sync-tabs">
                <button class="sync-tab active" onclick="switchTab('auto')">ðŸ”„ Auto-Sync</button>
                <button class="sync-tab" onclick="switchTab('manual')">ðŸ“‹ Manual Code</button>
            </div>

            <!-- Auto-Sync Tab -->
            <div id="autoSyncTab" class="tab-content active">
                <div style="margin: 20px 0;">
                    <p class="info-text" style="margin-bottom: 15px;">
                        Automatically sync your profile across your devices
                    </p>
                    
                    <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin: 20px 0;">
                        <span style="font-family: 'Cinzel', serif; font-size: 1.1rem;">Auto-Sync:</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoSyncToggle" onchange="toggleAutoSync()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span id="autoSyncStatus" style="color: var(--text-secondary); font-style: italic;">Disabled</span>
                    </div>

                    <div id="autoSyncInfo" style="display: none; margin-top: 20px;">
                        <div class="sync-code-display">
                            <p style="color: var(--maat-silver); margin-bottom: 10px;">Your Device ID:</p>
                            <div style="font-family: 'Courier New', monospace; font-size: 1rem; color: var(--caerus-gold); word-break: break-all;" id="deviceId"></div>
                            <p class="info-text" style="margin-top: 10px;">This device is now syncing automatically</p>
                        </div>

                        <p class="info-text">
                            â„¹ï¸ Changes will sync every 30 seconds while auto-sync is enabled
                        </p>
                    </div>
                </div>
            </div>

            <!-- Manual Code Tab -->
            <div id="manualCodeTab" class="tab-content">
                <div id="generateSection">
                    <p class="info-text">Generate a code to transfer your profile to another device</p>
                    
                    <div class="sync-buttons">
                        <button class="sync-btn primary" onclick="generateSyncCode()">
                            âœ¨ Generate Code
                        </button>
                        <button class="sync-btn secondary" onclick="showLoadSection()">
                            ðŸ“¥ Load from Code
                        </button>
                    </div>

                    <div id="codeDisplay" style="display: none;">
                        <div class="sync-code-display">
                            <p style="color: var(--maat-silver); margin-bottom: 10px;">Your Sync Code:</p>
                            <div class="sync-code" id="syncCodeText">GE-XXXXX</div>
                            <p class="info-text">Code expires in 7 days â€¢ Click to copy</p>
                            <button class="sync-btn primary" onclick="copySyncCode()" style="margin-top: 15px;">
                                ðŸ“‹ Copy Code
                            </button>
                        </div>

                        <div id="qrCodeSection" style="text-align: center; margin-top: 20px;">
                            <p style="color: var(--maat-silver); margin-bottom: 10px;">Or scan with your phone:</p>
                            <div class="qr-code-container" id="qrCodeContainer"></div>
                        </div>
                    </div>
                </div>

                <div id="loadSection" style="display: none;">
                    <p class="info-text">Enter the code from your other device</p>
                    
                    <div class="code-input-section">
                        <input type="text" class="code-input" id="codeInput" placeholder="GE-XXXXX" maxlength="9">
                    </div>

                    <div class="sync-buttons">
                        <button class="sync-btn primary" onclick="loadFromCode()" id="loadBtn">
                            ðŸ”„ Load Profile
                        </button>
                        <button class="sync-btn secondary" onclick="showGenerateSection()">
                            â† Back
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Quill Rich Text Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script>
        // Configuration
        const IMGBB_API_KEY = 'fecb6b8c48020815465bbc22d8c0e7b0';
        const JSONBIN_API_KEY = '$2a$10$IHpJv8M/m2qmjz8AHAJvpuBmVIJUtlPTSnAh0FRKUq1a90bDmA7Mm';
        const AUTO_SYNC_INTERVAL = 30000; // 30 seconds

        let autoSyncTimer = null;

        // Default profile data
        const defaultProfile = {
            name: 'Lord Edmund Ashford',
            rank: 'Apprentice Scribe',
            avatar: 'ðŸ“œ',
            avatarType: 'emoji',
            avatarUrl: null,
            level: 5,
            xp: 1250,
            xpMax: 2000,
            focus: 75,
            workings: 28,
            daysActive: 14,
            virtues: {
                thoth: { points: 420, rank: 'Apprentice Scholar', progress: 68 },
                maat: { points: 285, rank: 'Novice Keeper', progress: 45 },
                caerus: { points: 198, rank: 'Initiate Seeker', progress: 33 }
            }
        };

        // Generate device fingerprint
        function generateDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'GE-DEV-' + Math.random().toString(36).substring(2, 15);
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }

        // Load profile and convert from rich schema to dashboard format
        function loadProfile() {
            let saved = localStorage.getItem('grimorioProfile');
            
            // Initialize empty profile if none exists
            if (!saved) {
                const emptyProfile = {
                    scribeName: 'Unnamed Scribe',
                    overallRank: 1,
                    totalPoints: 0,
                    totalWorkings: 0,
                    currentStreak: 0,
                    longestStreak: 0,
                    oathDate: new Date().toISOString(),
                    thoth: { points: 0, level: 1 },
                    maat: { points: 0, level: 1 },
                    caerus: { points: 0, level: 1 },
                    specializations: {
                        herbalist: { unlocked: false, progress: 0 },
                        astrologer: { unlocked: false, progress: 0 },
                        alchemist: { unlocked: false, progress: 0 },
                        guardian: { unlocked: false, progress: 0 },
                        scholar: { unlocked: false, progress: 0 },
                        polyglot: { unlocked: false, progress: 0 }
                    },
                    goals: [],
                    backstory: '',
                    personalMotto: 'Amo Ä‰iujn, fidu malmultajn, difektu neniun',
                    currentFocus: 'Beginning the path of the Three Virtues',
                    studiolLocation: 'My Sacred Space',
                    patronVirtue: 'thoth'
                };
                localStorage.setItem('grimorioProfile', JSON.stringify(emptyProfile));
                saved = JSON.stringify(emptyProfile);
            }
            
            const richProfile = JSON.parse(saved);
            
            // Map from rich profile schema (profile.js/quests.js) to dashboard format
            return {
                name: richProfile.scribeName || 'Unnamed Scribe',
                rank: getRankTitle(richProfile.overallRank || 1),
                avatar: richProfile.avatar || 'ðŸ“œ',
                avatarType: richProfile.avatarType || 'emoji',
                avatarUrl: richProfile.avatarUrl || null,
                level: Math.floor((richProfile.totalPoints || 0) / 100) + 1,
                xp: (richProfile.totalPoints || 0) % 100,
                xpMax: 100,
                focus: calculateFocus(richProfile),
                workings: richProfile.totalWorkings || 0,
                daysActive: calculateDaysActive(richProfile),
                virtues: {
                    thoth: {
                        points: richProfile.thoth?.points || 0,
                        rank: getVirtueRank(richProfile.thoth?.level || 1),
                        progress: ((richProfile.thoth?.points || 0) % 100)
                    },
                    maat: {
                        points: richProfile.maat?.points || 0,
                        rank: getVirtueRank(richProfile.maat?.level || 1),
                        progress: ((richProfile.maat?.points || 0) % 100)
                    },
                    caerus: {
                        points: richProfile.caerus?.points || 0,
                        rank: getVirtueRank(richProfile.caerus?.level || 1),
                        progress: ((richProfile.caerus?.points || 0) % 100)
                    }
                }
            };
        }
        
        // Convert rank number to title
        function getRankTitle(rank) {
            const titles = ['Initiate', 'Apprentice', 'Journeyman', 'Adept', 'Master', 'Grandmaster'];
            return (titles[rank - 1] || 'Initiate') + ' Scribe';
        }
        
        // Get virtue rank from level
        function getVirtueRank(level) {
            const virtueRanks = ['Seeker', 'Initiate', 'Novice', 'Apprentice', 'Scholar', 'Keeper', 'Master'];
            return virtueRanks[Math.min(level - 1, 6)] || 'Seeker';
        }
        
        // Calculate focus from practice stats
        function calculateFocus(profile) {
            const streakBonus = Math.min((profile.currentStreak || 0) * 5, 50);
            const practiceBonus = Math.min((profile.totalWorkings || 0) * 2, 50);
            return Math.min(streakBonus + practiceBonus, 100);
        }
        
        // Calculate days active from oath date
        function calculateDaysActive(profile) {
            if (!profile.oathDate) return 0;
            const oath = new Date(profile.oathDate);
            const now = new Date();
            const diff = Math.floor((now - oath) / (1000 * 60 * 60 * 24));
            return Math.max(diff, 0);
        }

        // Save profile
        function saveProfileData(profile) {
            localStorage.setItem('grimorioProfile', JSON.stringify(profile));
            
            // If auto-sync is enabled, sync immediately
            if (localStorage.getItem('autoSyncEnabled') === 'true') {
                syncToCloud();
            }
        }

        // Show sync status
        function showSyncStatus(message, type = 'syncing') {
            const status = document.getElementById('syncStatus');
            const text = document.getElementById('syncStatusText');
            status.className = 'sync-status ' + type;
            text.textContent = message;
            status.style.display = 'flex';
            
            if (type !== 'syncing') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            }
        }

        // Sync to cloud (auto-sync)
        async function syncToCloud() {
            const deviceId = generateDeviceId();
            const profile = loadProfile();
            
            showSyncStatus('Syncing...', 'syncing');
            
            try {
                const response = await fetch('https://api.jsonbin.io/v3/b', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY,
                        'X-Collection-Id': deviceId // Use device ID as collection
                    },
                    body: JSON.stringify({
                        deviceId: deviceId,
                        profile: profile,
                        updated: new Date().toISOString()
                    })
                });

                const data = await response.json();
                
                if (data.metadata && data.metadata.id) {
                    localStorage.setItem('cloudBinId', data.metadata.id);
                    showSyncStatus('Synced âœ“', 'success');
                    console.log('Auto-sync successful');
                }
            } catch (error) {
                console.error('Auto-sync error:', error);
                showSyncStatus('Sync failed', 'error');
            }
        }

        // Load from cloud (auto-sync)
        async function loadFromCloud() {
            const binId = localStorage.getItem('cloudBinId');
            if (!binId) return;
            
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });

                const data = await response.json();
                
                if (data.record && data.record.profile) {
                    const cloudProfile = data.record.profile;
                    const localProfile = loadProfile();
                    
                    // Compare timestamps to avoid overwriting newer local data
                    const cloudTime = new Date(data.record.updated).getTime();
                    const localTime = new Date(localStorage.getItem('lastModified') || 0).getTime();
                    
                    if (cloudTime > localTime) {
                        localStorage.setItem('grimorioProfile', JSON.stringify(cloudProfile));
                        updateUI(cloudProfile);
                        console.log('Profile updated from cloud');
                    }
                }
            } catch (error) {
                console.error('Load from cloud error:', error);
            }
        }

        // Toggle auto-sync
        function toggleAutoSync() {
            const toggle = document.getElementById('autoSyncToggle');
            const status = document.getElementById('autoSyncStatus');
            const info = document.getElementById('autoSyncInfo');
            const syncBtn = document.getElementById('syncModeBtn');
            
            if (toggle.checked) {
                localStorage.setItem('autoSyncEnabled', 'true');
                status.textContent = 'Enabled';
                status.style.color = 'var(--caerus-gold)';
                info.style.display = 'block';
                
                // Update all sync buttons
                const allSyncBtns = document.querySelectorAll('#syncModeBtn, #navSyncBtn');
                allSyncBtns.forEach(btn => btn.classList.add('auto-sync-enabled'));
                
                document.getElementById('deviceId').textContent = generateDeviceId();
                
                // Start auto-sync
                syncToCloud();
                autoSyncTimer = setInterval(syncToCloud, AUTO_SYNC_INTERVAL);
                
                // Also check for updates
                setInterval(loadFromCloud, AUTO_SYNC_INTERVAL);
                
                alert('âœ¨ Auto-sync enabled! Your profile will sync automatically across devices using the same browser account.');
            } else {
                localStorage.setItem('autoSyncEnabled', 'false');
                status.textContent = 'Disabled';
                status.style.color = 'var(--text-secondary)';
                info.style.display = 'none';
                
                // Update all sync buttons
                const allSyncBtns = document.querySelectorAll('#syncModeBtn, #navSyncBtn');
                allSyncBtns.forEach(btn => btn.classList.remove('auto-sync-enabled'));
                
                if (autoSyncTimer) {
                    clearInterval(autoSyncTimer);
                    autoSyncTimer = null;
                }
            }
        }

        // Update UI
        function updateUI(profile) {
            document.getElementById('scribeName').textContent = profile.name;
            document.getElementById('scribeRank').textContent = profile.rank;
            document.getElementById('currentLevel').textContent = profile.level;
            document.getElementById('xpDisplay').textContent = `${profile.xp.toLocaleString()} / ${profile.xpMax.toLocaleString()}`;
            document.getElementById('focusDisplay').textContent = `${profile.focus}%`;
            document.getElementById('totalWorkings').textContent = profile.workings;
            document.getElementById('daysActive').textContent = profile.daysActive;

            const avatarEl = document.getElementById('profileAvatar');
            if (profile.avatarType === 'image' && profile.avatarUrl) {
                avatarEl.innerHTML = `<img src="${profile.avatarUrl}" alt="Avatar">`;
            } else {
                avatarEl.textContent = profile.avatar;
            }

            const xpPercent = (profile.xp / profile.xpMax) * 100;
            document.getElementById('xpBar').style.width = `${xpPercent}%`;
            document.getElementById('focusBar').style.width = `${profile.focus}%`;

            document.getElementById('thothPoints').textContent = profile.virtues.thoth.points;
            document.getElementById('thothRank').textContent = `Rank: ${profile.virtues.thoth.rank}`;
            document.getElementById('thothProgress').style.width = `${profile.virtues.thoth.progress}%`;

            document.getElementById('maatPoints').textContent = profile.virtues.maat.points;
            document.getElementById('maatRank').textContent = `Rank: ${profile.virtues.maat.rank}`;
            document.getElementById('maatProgress').style.width = `${profile.virtues.maat.progress}%`;

            document.getElementById('caerusPoints').textContent = profile.virtues.caerus.points;
            document.getElementById('caerusRank').textContent = `Rank: ${profile.virtues.caerus.rank}`;
            document.getElementById('caerusProgress').style.width = `${profile.virtues.caerus.progress}%`;

            updateMoonAndPlanet();
        }

        // Update moon and planet
        function updateMoonAndPlanet() {
            const moonPhases = ['ðŸŒ‘', 'ðŸŒ’', 'ðŸŒ“', 'ðŸŒ”', 'ðŸŒ•', 'ðŸŒ–', 'ðŸŒ—', 'ðŸŒ˜'];
            const planets = ['â˜‰', 'â˜½', 'â™‚', 'â˜¿', 'â™ƒ', 'â™€', 'â™„'];
            
            const date = new Date();
            const dayOfWeek = date.getDay();
            
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const c = Math.floor((year - 1900) / 100);
            const e = Math.floor((11 * (year % 19) + c - Math.floor(c / 4) - Math.floor((8 * c + 13) / 25) + month + day + 2) % 30);
            const phaseIndex = Math.floor((e / 30) * 8);
            
            document.getElementById('moonPhase').textContent = moonPhases[phaseIndex];
            document.getElementById('todayPlanet').textContent = planets[dayOfWeek];
        }

        // Upload avatar
        async function uploadAvatar(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (IMGBB_API_KEY === 'YOUR_IMGBB_API_KEY_HERE') {
                alert('âš ï¸ Please add your ImgBB API key!\n\nGet a free key at: https://api.imgbb.com/');
                return;
            }

            const uploadBtn = document.getElementById('uploadBtn');
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<span class="loading-spinner"></span> Uploading...';

            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    const imageUrl = data.data.url;
                    const preview = document.getElementById('avatarPreview');
                    preview.innerHTML = `<img src="${imageUrl}" alt="Avatar Preview">`;
                    preview.dataset.imageUrl = imageUrl;
                    
                    document.querySelectorAll('.avatar-option').forEach(o => o.classList.remove('selected'));
                    
                    uploadBtn.innerHTML = 'âœ“ Image Uploaded!';
                    setTimeout(() => {
                        uploadBtn.innerHTML = 'ðŸ“· Upload Custom Avatar';
                        uploadBtn.disabled = false;
                    }, 2000);
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                console.error('Upload error:', error);
                alert('âŒ Failed to upload image. Please try again.');
                uploadBtn.innerHTML = 'ðŸ“· Upload Custom Avatar';
                uploadBtn.disabled = false;
            }
        }

        // Profile Modal
        function openProfileModal() {
            const profile = loadProfile();
            document.getElementById('nameInput').value = profile.name;
            document.getElementById('rankInput').value = profile.rank;
            document.getElementById('levelInput').value = profile.level;
            
            const preview = document.getElementById('avatarPreview');
            if (profile.avatarType === 'image' && profile.avatarUrl) {
                preview.innerHTML = `<img src="${profile.avatarUrl}" alt="Avatar">`;
                preview.dataset.imageUrl = profile.avatarUrl;
            } else {
                preview.textContent = profile.avatar;
                preview.dataset.imageUrl = '';
            }
            
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.avatar === profile.avatar && profile.avatarType === 'emoji') {
                    option.classList.add('selected');
                }
            });
            
            document.getElementById('profileModal').classList.add('active');
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }

        function saveProfile(event) {
            event.preventDefault();
            
            const profile = loadProfile();
            profile.name = document.getElementById('nameInput').value;
            profile.rank = document.getElementById('rankInput').value;
            profile.level = parseInt(document.getElementById('levelInput').value);
            
            const preview = document.getElementById('avatarPreview');
            const imageUrl = preview.dataset.imageUrl;
            
            if (imageUrl) {
                profile.avatarType = 'image';
                profile.avatarUrl = imageUrl;
            } else {
                const selectedAvatar = document.querySelector('.avatar-option.selected');
                if (selectedAvatar) {
                    profile.avatar = selectedAvatar.dataset.avatar;
                    profile.avatarType = 'emoji';
                    profile.avatarUrl = null;
                }
            }
            
            localStorage.setItem('lastModified', new Date().toISOString());
            saveProfileData(profile);
            updateUI(profile);
            closeProfileModal();
            
            alert('âœ¨ Profile updated successfully!');
        }

        // Sync Modal
        function openSyncModal() {
            // Check and set auto-sync status
            const autoSyncEnabled = localStorage.getItem('autoSyncEnabled') === 'true';
            document.getElementById('autoSyncToggle').checked = autoSyncEnabled;
            
            if (autoSyncEnabled) {
                document.getElementById('autoSyncStatus').textContent = 'Enabled';
                document.getElementById('autoSyncStatus').style.color = 'var(--caerus-gold)';
                document.getElementById('autoSyncInfo').style.display = 'block';
                document.getElementById('deviceId').textContent = generateDeviceId();
            }
            
            document.getElementById('syncModal').classList.add('active');
        }

        function closeSyncModal() {
            document.getElementById('syncModal').classList.remove('active');
            document.getElementById('codeDisplay').style.display = 'none';
            document.getElementById('qrCodeContainer').innerHTML = '';
        }

        function switchTab(tab) {
            document.querySelectorAll('.sync-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'auto') {
                document.querySelector('.sync-tab:first-child').classList.add('active');
                document.getElementById('autoSyncTab').classList.add('active');
            } else {
                document.querySelector('.sync-tab:last-child').classList.add('active');
                document.getElementById('manualCodeTab').classList.add('active');
            }
        }

        function showGenerateSection() {
            document.getElementById('generateSection').style.display = 'block';
            document.getElementById('loadSection').style.display = 'none';
        }

        function showLoadSection() {
            document.getElementById('generateSection').style.display = 'none';
            document.getElementById('loadSection').style.display = 'block';
            document.getElementById('codeInput').value = '';
        }

        // Generate manual sync code
        async function generateSyncCode() {
            const profile = loadProfile();
            const code = 'GE-' + Math.random().toString(36).substring(2, 7).toUpperCase();
            
            try {
                const response = await fetch('https://api.jsonbin.io/v3/b', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify({
                        code: code,
                        profile: profile,
                        created: new Date().toISOString()
                    })
                });

                const data = await response.json();
                
                if (data.metadata && data.metadata.id) {
                    const binId = data.metadata.id;
                    localStorage.setItem('syncCode_' + code, binId);
                    
                    document.getElementById('syncCodeText').textContent = code;
                    document.getElementById('codeDisplay').style.display = 'block';
                    
                    document.getElementById('qrCodeContainer').innerHTML = '';
                    new QRCode(document.getElementById('qrCodeContainer'), {
                        text: code,
                        width: 200,
                        height: 200
                    });
                    
                    console.log('âœ“ Manual sync code generated!');
                } else {
                    throw new Error('Invalid response from JSONbin');
                }
                
            } catch (error) {
                console.error('Sync error:', error);
                alert('âš ï¸ Failed to generate code. Please check your internet connection.');
            }
        }

        function copySyncCode() {
            const code = document.getElementById('syncCodeText').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('âœ¨ Code copied to clipboard!');
            });
        }

        async function loadFromCode() {
            const code = document.getElementById('codeInput').value.trim().toUpperCase();
            
            if (!code || !code.startsWith('GE-')) {
                alert('âš ï¸ Please enter a valid code (format: GE-XXXXX)');
                return;
            }

            const loadBtn = document.getElementById('loadBtn');
            loadBtn.disabled = true;
            loadBtn.innerHTML = '<span class="loading-spinner"></span> Loading...';

            try {
                const binId = localStorage.getItem('syncCode_' + code);
                
                if (binId && binId.length > 10) {
                    try {
                        const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                            method: 'GET',
                            headers: {
                                'X-Master-Key': JSONBIN_API_KEY
                            }
                        });

                        const data = await response.json();
                        
                        if (data.record && data.record.profile) {
                            const profile = data.record.profile;
                            saveProfileData(profile);
                            updateUI(profile);
                            closeSyncModal();
                            alert('âœ¨ Profile loaded from cloud successfully!');
                            loadBtn.disabled = false;
                            loadBtn.innerHTML = 'ðŸ”„ Load Profile';
                            return;
                        }
                    } catch (cloudError) {
                        console.warn('Cloud fetch failed:', cloudError);
                    }
                }
                
                alert('âš ï¸ Code not found. Make sure you entered it correctly.');
                
            } catch (error) {
                console.error('Load error:', error);
                alert('âŒ Failed to load profile. Please try again.');
            } finally {
                loadBtn.disabled = false;
                loadBtn.innerHTML = 'ðŸ”„ Load Profile';
            }
        }

        // Avatar selection
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.avatar-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    const preview = document.getElementById('avatarPreview');
                    preview.textContent = this.dataset.avatar;
                    preview.dataset.imageUrl = '';
                });
            });
        });

        // Close modals on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }

        // Make sync code clickable
        document.addEventListener('click', function(e) {
            if (e.target.id === 'syncCodeText') {
                copySyncCode();
            }
        });

        // ===== NEW TABBED INTERFACE FUNCTIONS =====
        
        // Main Tab Switching
        // Section and Tab Management
        const sectionTabs = {
            'dashboard': [],
            'study': [
                { id: 'notes', label: 'ðŸ“ Notes' },
                { id: 'workingLog', label: 'ðŸŒ¿ Working Log' }
            ],
            'practice': [
                { id: 'quests', label: 'â­ Quests' },
                { id: 'toolkit', label: 'ðŸ› ï¸ Toolkit' },
                { id: 'moon', label: 'ðŸŒ™ Moon Tracker' },
                { id: 'sigilGen', label: 'âœ¨ Sigil Generator' },
                { id: 'esperanto', label: 'ðŸ—£ï¸ Esperanto' }
            ],
            'you': [
                { id: 'profile', label: 'ðŸ‘¤ Profile' },
                { id: 'progress', label: 'ðŸ“Š Progress' }
            ]
        };

        function switchSection(section) {
            // Update top nav active state
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Get tabs for this section
            const tabs = sectionTabs[section];
            const tabsContainer = document.getElementById('dynamicTabs');
            
            // Hide all tab contents
            document.querySelectorAll('.main-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (section === 'dashboard') {
                // Dashboard: No tabs, just show activity
                tabsContainer.innerHTML = '';
                tabsContainer.style.display = 'none';
                document.getElementById('activityTabContent').classList.add('active');

                // Ensure quests and activity feed are initialized when switching to Dashboard
                try {
                    initializeQuestSystem();
                    displayActivityFeed();
                    updateDebugBadge(window.__debug || {});
                } catch (e) {
                    console.warn('Dashboard init fallback encountered an error:', e);
                }
            } else {
                // Other sections: Show tabs
                tabsContainer.style.display = 'flex';
                tabsContainer.innerHTML = tabs.map((tab, index) => 
                    `<button class="main-tab ${index === 0 ? 'active' : ''}" onclick="switchTab('${tab.id}')">${tab.label}</button>`
                ).join('');
                
                // Show first tab's content by default
                const firstTabId = tabs[0].id + 'TabContent';
                const firstTab = document.getElementById(firstTabId);
                if (firstTab) {
                    firstTab.classList.add('active');
                }
                
                // Load content if needed
                if (tabs[0].id === 'notes') {
                    loadNotesCompact();
                } else if (tabs[0].id === 'toolkit') {
                    loadToolkitState();
                }
            }
        }

        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.main-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            const targetContent = document.getElementById(tabName + 'TabContent');
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Load content if needed
            if (tabName === 'notes') {
                loadNotesCompact();
            } else if (tabName === 'toolkit') {
                loadToolkitState();
            }
        }

        // Keep old function for compatibility but redirect to switchSection
        function switchSection(section) {
            // Update top nav active states
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Find and activate the corresponding nav link
            const navLinks = {
                'dashboard': 'ðŸŽ® Dashboard',
                'study': 'ðŸ“š Study',
                'volumes': 'ðŸ“– Volumes',
                'practice': 'ðŸŽ¯ Practice',
                'you': 'ðŸ‘¤ You'
            };
            
            const targetNavText = navLinks[section];
            if (targetNavText) {
                const targetNav = Array.from(document.querySelectorAll('.nav-link'))
                    .find(link => link.textContent.trim() === targetNavText);
                if (targetNav) {
                    targetNav.classList.add('active');
                }
            }
            
            // Get dynamic tabs container
            const tabsContainer = document.getElementById('dynamicTabs');
            
            // Define tabs for each section
            const sectionTabs = {
                dashboard: `<span class="section-subtitle">ðŸ“‹ Recent Activity Feed</span>`,
                study: `
                    <button class="main-tab active" onclick="switchMainTab('notes')">ðŸ“ Notes</button>
                    <button class="main-tab" onclick="switchMainTab('workinglog')">ðŸŒ¿ Working Log</button>
                `,
                volumes: `
                    <button class="main-tab active" onclick="switchMainTab('volume1')">ðŸ“– Volume I</button>
                    <button class="main-tab" onclick="switchMainTab('volume2')">ðŸ“– Volume II</button>
                    <button class="main-tab" onclick="switchMainTab('volume3')">ðŸ“– Volume III</button>
                    <button class="main-tab" onclick="switchMainTab('volume4')">ðŸ“– Volume IV</button>
                    <button class="main-tab" onclick="switchMainTab('volume5')">ðŸ“– Volume V</button>
                `,
                practice: `
                    <button class="main-tab active" onclick="switchMainTab('toolkit')">ðŸ› ï¸ Toolkit</button>
                    <button class="main-tab" onclick="switchMainTab('moon')">ðŸŒ™ Moon Tracker</button>
                    <button class="main-tab" onclick="switchMainTab('sigil')">âœ¨ Sigil Generator</button>
                    <button class="main-tab" onclick="switchMainTab('esperanto')">ðŸ—£ï¸ Esperanto</button>
                `,
                you: `
                    <button class="main-tab active" onclick="switchMainTab('profile')">ðŸ‘¤ Profile</button>
                    <button class="main-tab" onclick="switchMainTab('progress')">ðŸ“Š Progress</button>
                `
            };
            
            // Update tabs
            tabsContainer.innerHTML = sectionTabs[section] || '';
            
            // Define default tab for each section
            const defaultTabs = {
                dashboard: 'activity',
                study: 'notes',
                volumes: 'volume1',
                practice: 'toolkit',
                you: 'profile'
            };
            
            // Switch to default tab for the section
            const targetTab = defaultTabs[section];
            if (targetTab) {
                // Hide all tab contents
                document.querySelectorAll('.main-tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Show target tab content
                const targetContent = document.getElementById(targetTab + 'TabContent');
                if (targetContent) {
                    targetContent.classList.add('active');
                }
                
                // Load specific data if needed
                if (targetTab === 'notes') {
                    loadNotesCompact();
                } else if (targetTab === 'toolkit') {
                    loadToolkitState();
                }
            }
        }

        // ========================================
        // MOON PHASE CALCULATOR
        // ========================================
        
        function getMoonPhase(date) {
            // Known new moon: January 6, 2000, 18:14 UTC
            const knownNewMoon = new Date('2000-01-06T18:14:00Z');
            const synodicMonth = 29.53058867; // days in lunar cycle
            
            // Calculate days since known new moon
            const daysSince = (date - knownNewMoon) / (1000 * 60 * 60 * 24);
            
            // Calculate current position in cycle (0-1)
            const phase = (daysSince % synodicMonth) / synodicMonth;
            
            // Calculate illumination percentage
            const illumination = Math.abs(Math.cos(phase * 2 * Math.PI)) * 100;
            
            return {
                phase: phase,
                illumination: illumination.toFixed(1),
                age: daysSince % synodicMonth
            };
        }
        
        function getMoonPhaseName(phase) {
            if (phase < 0.0625) return { name: 'New Moon', emoji: 'ðŸŒ‘', desc: 'New Beginnings' };
            if (phase < 0.1875) return { name: 'Waxing Crescent', emoji: 'ðŸŒ’', desc: 'Setting Intentions' };
            if (phase < 0.3125) return { name: 'First Quarter', emoji: 'ðŸŒ“', desc: 'Taking Action' };
            if (phase < 0.4375) return { name: 'Waxing Gibbous', emoji: 'ðŸŒ”', desc: 'Refinement' };
            if (phase < 0.5625) return { name: 'Full Moon', emoji: 'ðŸŒ•', desc: 'Peak Power' };
            if (phase < 0.6875) return { name: 'Waning Gibbous', emoji: 'ðŸŒ–', desc: 'Gratitude' };
            if (phase < 0.8125) return { name: 'Last Quarter', emoji: 'ðŸŒ—', desc: 'Release' };
            if (phase < 0.9375) return { name: 'Waning Crescent', emoji: 'ðŸŒ˜', desc: 'Rest' };
            return { name: 'New Moon', emoji: 'ðŸŒ‘', desc: 'New Beginnings' };
        }
        
        function getPhaseGuidance(phaseName) {
            const guidance = {
                'New Moon': {
                    keywords: 'ðŸŒ± Initiation â€¢ Setting Intentions â€¢ Fresh Starts',
                    workings: [
                        'âœ¨ Set intentions for the lunar cycle',
                        'ðŸ“ Write goals and wishes',
                        'ðŸŒ¿ Plant seeds (literal and metaphorical)',
                        'ðŸ”® Divination for guidance',
                        'ðŸ§˜ Meditation on new beginnings'
                    ],
                    avoid: ['Major banishing', 'Releasing old patterns', 'Completion rituals']
                },
                'Waxing Crescent': {
                    keywords: 'ðŸŒ± Growth â€¢ Building â€¢ Attraction',
                    workings: [
                        'ðŸ’° Prosperity spells',
                        'â¤ï¸ Attraction workings',
                        'ðŸ“š Study and learning',
                        'ðŸŒ¿ Growth magic',
                        'âœ¨ Building positive habits'
                    ],
                    avoid: ['Banishing', 'Releasing', 'Endings']
                },
                'First Quarter': {
                    keywords: 'âš¡ Action â€¢ Commitment â€¢ Challenges',
                    workings: [
                        'ðŸ’ª Strength and courage spells',
                        'ðŸŽ¯ Goal manifestation',
                        'âš”ï¸ Overcoming obstacles',
                        'ðŸ”¥ Energy work',
                        'ðŸ“Š Decision-making rituals'
                    ],
                    avoid: ['Passive meditation', 'Rest', 'Letting go']
                },
                'Waxing Gibbous': {
                    keywords: 'ðŸ”§ Refinement â€¢ Adjustment â€¢ Preparation',
                    workings: [
                        'âœ¨ Fine-tuning intentions',
                        'ðŸ”® Clarity spells',
                        'ðŸ“– Deep study',
                        'âš—ï¸ Perfecting recipes',
                        'ðŸŽ¨ Creative work'
                    ],
                    avoid: ['Starting new projects', 'Rushing', 'Skipping details']
                },
                'Full Moon': {
                    keywords: 'ðŸŒ• Peak Power â€¢ Culmination â€¢ Charging',
                    workings: [
                        'âš¡ Charging crystals and tools',
                        'ðŸ’§ Making moon water',
                        'ðŸ”® Powerful divination',
                        'âœ¨ Manifestation peak',
                        'ðŸŽ‰ Gratitude rituals',
                        'ðŸŒ¿ Harvesting herbs'
                    ],
                    avoid: ['Starting new ventures', 'Banishing (unless absolutely needed)']
                },
                'Waning Gibbous': {
                    keywords: 'ðŸ™ Gratitude â€¢ Sharing â€¢ Reflection',
                    workings: [
                        'ðŸ™ Gratitude ceremonies',
                        'ðŸ“š Teaching and sharing knowledge',
                        'ðŸ”„ Reviewing progress',
                        'ðŸ’ Generosity magic',
                        'âœ¨ Giving thanks'
                    ],
                    avoid: ['Attracting new things', 'Building up energy']
                },
                'Last Quarter': {
                    keywords: 'ðŸ§¹ Release â€¢ Banishing â€¢ Clearing',
                    workings: [
                        'ðŸ§¹ Cleansing and purification',
                        'âŒ Banishing negative energy',
                        'ðŸ—‘ï¸ Releasing bad habits',
                        'ðŸ’¨ Clearing obstacles',
                        'ðŸ”¥ Burning away the old'
                    ],
                    avoid: ['Attraction magic', 'Building energy', 'New starts']
                },
                'Waning Crescent': {
                    keywords: 'ðŸŒ™ Rest â€¢ Recuperation â€¢ Wisdom',
                    workings: [
                        'ðŸ§˜ Deep meditation',
                        'ðŸ˜´ Dream work',
                        'ðŸ“– Intuitive study',
                        'ðŸ•Šï¸ Inner peace rituals',
                        'ðŸŒ‘ Preparing for new cycle'
                    ],
                    avoid: ['High-energy work', 'Major spells', 'Action-oriented magic']
                }
            };
            
            return guidance[phaseName] || guidance['New Moon'];
        }
        
        function calculateNextMajorPhases(currentDate) {
            const synodicMonth = 29.53058867;
            const phases = [];
            
            // Major phase positions in cycle
            const majorPhases = [
                { name: 'New Moon', position: 0, emoji: 'ðŸŒ‘' },
                { name: 'First Quarter', position: 0.25, emoji: 'ðŸŒ“' },
                { name: 'Full Moon', position: 0.5, emoji: 'ðŸŒ•' },
                { name: 'Last Quarter', position: 0.75, emoji: 'ðŸŒ—' }
            ];
            
            const current = getMoonPhase(currentDate);
            const currentPhase = current.phase;
            
            // Find next 4 major phases
            majorPhases.forEach(major => {
                let targetPhase = major.position;
                
                // If we've passed this phase in current cycle, add to next cycle
                if (currentPhase > targetPhase) {
                    targetPhase += 1;
                }
                
                const daysUntil = (targetPhase - currentPhase) * synodicMonth;
                const date = new Date(currentDate.getTime() + daysUntil * 24 * 60 * 60 * 1000);
                
                phases.push({
                    name: major.name,
                    emoji: major.emoji,
                    date: date,
                    daysUntil: Math.round(daysUntil)
                });
            });
            
            // Sort by date
            phases.sort((a, b) => a.date - b.date);
            
            return phases.slice(0, 4); // Return next 4 major phases
        }
        
        function updateMoonTracker() {
            const now = new Date();
            const moonData = getMoonPhase(now);
            const phaseInfo = getMoonPhaseName(moonData.phase);
            const guidance = getPhaseGuidance(phaseInfo.name);
            const upcomingPhases = calculateNextMajorPhases(now);
            
            // Update current phase display
            document.getElementById('currentPhaseName').textContent = phaseInfo.name;
            document.getElementById('currentPhaseDate').textContent = now.toLocaleDateString('en-US', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });
            document.getElementById('moonIllumination').textContent = `${moonData.illumination}% illuminated`;
            
            // Update visual moon
            updateMoonVisual(moonData.phase);
            
            // Update upcoming phases
            const upcomingHTML = upcomingPhases.map(phase => `
                <div class="moon-phase-item">
                    <span class="moon-icon-small">${phase.emoji}</span>
                    <div class="moon-phase-info">
                        <div class="moon-phase-type">${phase.name}</div>
                        <div class="moon-phase-desc">
                            ${phase.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} 
                            (${phase.daysUntil} day${phase.daysUntil !== 1 ? 's' : ''})
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('upcomingPhases').innerHTML = upcomingHTML;
            
            // Update guidance
            const guidanceHTML = `
                <div class="phase-guidance-card">
                    <div class="guidance-title">${guidance.keywords}</div>
                    <p style="color: var(--text-secondary); margin: 10px 0;">Ideal workings for this phase:</p>
                    <ul class="guidance-list">
                        ${guidance.workings.map(w => `<li>${w}</li>`).join('')}
                    </ul>
                </div>
            `;
            document.getElementById('phaseGuidance').innerHTML = guidanceHTML;
            
            // Update countdown to next phase
            const nextPhase = upcomingPhases[0];
            const timeUntil = nextPhase.date - now;
            const days = Math.floor(timeUntil / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeUntil % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            
            const countdownHTML = `
                <div class="countdown-unit">
                    <div class="countdown-value">${days}</div>
                    <div class="countdown-label">Days</div>
                </div>
                <div class="countdown-unit">
                    <div class="countdown-value">${hours}</div>
                    <div class="countdown-label">Hours</div>
                </div>
            `;
            document.getElementById('nextPhaseCountdown').innerHTML = `
                <p style="color: var(--text-secondary); margin-bottom: 10px;">
                    Until ${nextPhase.emoji} ${nextPhase.name}
                </p>
                <div class="countdown-display">${countdownHTML}</div>
            `;
        }
        
        function updateMoonVisual(phase) {
            const moonShadow = document.getElementById('moonShadow');
            
            // Waxing phases (0 to 0.5)
            if (phase < 0.5) {
                const shadowWidth = (0.5 - phase) * 200; // 0-100%
                moonShadow.style.width = `${shadowWidth}%`;
                moonShadow.style.right = '0';
                moonShadow.style.left = 'auto';
            } 
            // Waning phases (0.5 to 1)
            else {
                const shadowWidth = (phase - 0.5) * 200; // 0-100%
                moonShadow.style.width = `${shadowWidth}%`;
                moonShadow.style.left = '0';
                moonShadow.style.right = 'auto';
            }
        }

        function switchMainTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.main-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active from all main tabs
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show target tab
            const targetContent = document.getElementById(tabName + 'TabContent');
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            // Highlight active tab button
            const activeTabBtn = Array.from(document.querySelectorAll('.main-tab'))
                .find(btn => btn.getAttribute('onclick')?.includes(`'${tabName}'`));
            if (activeTabBtn) {
                activeTabBtn.classList.add('active');
            }
            
            // Load specific content based on tab
            if (tabName === 'notes') {
                loadNotesCompact();
            } else if (tabName === 'toolkit') {
                loadToolkitState();
            } else if (tabName === 'moon') {
                updateMoonTracker();
            } else if (tabName.startsWith('volume')) {
                // Volumes are now embedded statically; no dynamic loading
                // Ensure existing content remains untouched
            }
        }
        
        // Load volume content from project files
        async function loadVolumeContent(volumeTab) {
            const volumeNum = volumeTab.replace('volume', '');
            const container = document.querySelector(`#${volumeTab}TabContent .volume-content`);
            
            if (!container) return;
            
            // If embedded content exists, mark as loaded and do nothing
            if (container.querySelector('.volume-embed') || (container.innerHTML && container.innerHTML.trim() !== '')) {
                container.setAttribute('data-loaded', 'true');
                return;
            }
            
            // Fallback: if truly empty, show a friendly message
            container.setAttribute('data-loaded', 'true');
            container.innerHTML = `<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Volume ${volumeNum} content not embedded.</p>`;
        }
        
        function getVolumeContent(volumeNum) {
            // Volume content will be embedded here
            // For now return placeholder
            return `<div class="card"><div class="card-content"><p>Volume ${volumeNum} content loading...</p></div></div>`;
        }
        
        function updateNavActiveState(tabName) {
            // Remove all active states
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Add active to appropriate nav link
            const navMap = {
                'activity': 'ðŸŽ® Dashboard',
                'profile': 'ðŸ‘¤ Profile',
                'notes': 'ðŸ“š Study â–¾',
                'progress': 'ðŸ“Š Progress',
                'toolkit': 'ðŸ› ï¸ Toolkit â–¾',
                'moon': 'ðŸ› ï¸ Toolkit â–¾'
            };
            
            const navText = navMap[tabName];
            if (navText) {
                const navLink = Array.from(document.querySelectorAll('.nav-link'))
                    .find(link => link.textContent.trim() === navText);
                if (navLink) {
                    navLink.classList.add('active');
                }
            }
        }

        // Profile Functions
        // Profile View/Edit Toggle Functions
        function toggleProfileEdit() {
            const viewMode = document.getElementById('profileViewMode');
            const editMode = document.getElementById('profileEditMode');
            const toggleBtn = document.getElementById('profileToggleBtn');
            
            if (viewMode.style.display === 'none') {
                // Switch to view mode
                viewMode.style.display = 'block';
                editMode.style.display = 'none';
                toggleBtn.textContent = 'âœï¸ Edit Mode';
                loadProfileView();
            } else {
                // Switch to edit mode
                viewMode.style.display = 'none';
                editMode.style.display = 'block';
                toggleBtn.textContent = 'ðŸ‘ï¸ View Mode';
                loadProfileEdit();
            }
        }

        function loadProfileView() {
            // Load from rich grimorioProfile
            const saved = localStorage.getItem('grimorioProfile');
            if (saved) {
                const data = JSON.parse(saved);
                const fullName = data.scribeName || 'Unnamed Scribe';
                const motto = data.personalMotto || 'Amo Ä‰iujn, fidu malmultajn, difektu neniun';
                const currentFocus = data.currentFocus || 'Beginning the path of the Three Virtues';
                const origin = data.studiolLocation || 'My Sacred Space';
                const backstory = data.backstory || '';
                const patronVirtue = data.patronVirtue === 'thoth' ? 'ðŸŒ™ Thoth' : data.patronVirtue === 'maat' ? 'âš–ï¸ Ma\'at' : 'âš¡ Caerus';
                
                document.getElementById('viewFullName').textContent = fullName;
                document.getElementById('viewPersonalMotto').textContent = motto;
                document.getElementById('viewCurrentFocus').textContent = currentFocus;
                document.getElementById('viewOrigin').textContent = origin;
                document.getElementById('viewPatronVirtue').textContent = patronVirtue;
                document.getElementById('viewBackstory').textContent = backstory;
                
                // Format oath date
                if (data.oathDate) {
                    const oathDate = new Date(data.oathDate);
                    document.getElementById('viewOathDate').textContent = oathDate.toLocaleDateString();
                }
                
                // Also update side profile card
                document.getElementById('scribeName').textContent = fullName;
                
                // Parse goals into list
                const goalsList = document.getElementById('viewGoals');
                const goalsArray = data.goals || [];
                if (Array.isArray(goalsArray) && goalsArray.length > 0) {
                    goalsList.innerHTML = goalsArray.map(goal => `<li>${goal.replace(/^[-â€¢]\s*/, '')}</li>`).join('');
                }

                // Load specializations and journal
                loadSpecializationsView(data);
                loadJournalView(data);
            }
            
            // Load profile photo
            const photo = localStorage.getItem('profilePhoto');
            if (photo) {
                document.getElementById('viewProfilePhoto').innerHTML = `<img src="${photo}" alt="Profile Photo">`;
                document.getElementById('profileAvatar').innerHTML = `<img src="${photo}" alt="Avatar">`;
            }
        }

        function loadProfileEdit() {
            // Load from rich grimorioProfile
            const saved = localStorage.getItem('grimorioProfile');
            if (saved) {
                const data = JSON.parse(saved);
                document.getElementById('editScribeName').value = data.scribeName || 'Unnamed Scribe';
                document.getElementById('editPersonalMotto').value = data.personalMotto || 'Amo Ä‰iujn, fidu malmultajn, difektu neniun';
                document.getElementById('editCurrentFocus').value = data.currentFocus || '';
                document.getElementById('editStudioloLocation').value = data.studiolLocation || 'My Sacred Space';
                document.getElementById('editPatronVirtue').value = data.patronVirtue || 'thoth';
                document.getElementById('editBackstory').value = data.backstory || '';
                
                // Parse oath date if available
                if (data.oathDate) {
                    const oathDate = new Date(data.oathDate);
                    const dateStr = oathDate.toISOString().split('T')[0];
                    document.getElementById('editOathDate').value = dateStr;
                }
                
                // Parse goals into text area (one per line)
                const goalsArray = data.goals || [];
                if (Array.isArray(goalsArray)) {
                    document.getElementById('editGoals').value = goalsArray.join('\n');
                }

                // Load journal reflection
                document.getElementById('editJournalReflection').value = data.journalReflection || '';
            }
            
            // Load profile photo in edit mode
            const photo = localStorage.getItem('profilePhoto');
            if (photo) {
                document.getElementById('editProfilePhotoPreview').innerHTML = `<img src="${photo}" alt="Profile Photo">`;
            }
        }

        // Function to update view mode after saving
        function loadProfileIntoViewMode(data) {
            const fullName = data.scribeName || 'Unnamed Scribe';
            const motto = data.personalMotto || 'Amo Ä‰iujn, fidu malmultajn, difektu neniun';
            const currentFocus = data.currentFocus || 'Beginning the path of the Three Virtues';
            const origin = data.studiolLocation || 'My Sacred Space';
            const backstory = data.backstory || '';
            const patronVirtue = data.patronVirtue === 'thoth' ? 'ðŸŒ™ Thoth' : data.patronVirtue === 'maat' ? 'âš–ï¸ Ma\'at' : 'âš¡ Caerus';
            
            document.getElementById('viewFullName').textContent = fullName;
            document.getElementById('viewPersonalMotto').textContent = motto;
            document.getElementById('viewCurrentFocus').textContent = currentFocus;
            document.getElementById('viewOrigin').textContent = origin;
            document.getElementById('viewPatronVirtue').textContent = patronVirtue;
            document.getElementById('viewBackstory').textContent = backstory;
            document.getElementById('scribeName').textContent = fullName;
            
            // Format oath date
            if (data.oathDate) {
                const oathDate = new Date(data.oathDate);
                document.getElementById('viewOathDate').textContent = oathDate.toLocaleDateString();
            }
            
            // Parse goals into list
            const goalsList = document.getElementById('viewGoals');
            const goalsArray = data.goals || [];
            if (Array.isArray(goalsArray) && goalsArray.length > 0) {
                goalsList.innerHTML = goalsArray.map(goal => `<li>${goal.replace(/^[-â€¢]\s*/, '')}</li>`).join('');
            }
            
            // Display specializations and journal
            loadSpecializationsView(data);
            loadJournalView(data);
        }

        // Display specializations in view mode
        function loadSpecializationsView(data) {
            const journeymanThreshold = 500;
            const isJourneyman = (data.totalPoints || 0) >= journeymanThreshold;
            const specContainer = document.getElementById('profileSpecializations');
            
            if (!specContainer) return;
            
            const specs = [
                {id: 'herbalist', name: 'ðŸŒ¿ Herbalist', desc: 'Master of botanical essences and plant lore'},
                {id: 'astrologer', name: 'ðŸŒ™ Astrologer', desc: 'Reader of celestial omens and lunar cycles'},
                {id: 'alchemist', name: 'âš—ï¸ Alchemist', desc: 'Transmuter of base materials and essences'},
                {id: 'guardian', name: 'âš”ï¸ Guardian', desc: 'Protector against dark forces and ill intent'},
                {id: 'scholar', name: 'ðŸ“š Scholar', desc: 'Keeper of ancient wisdom and hidden lore'},
                {id: 'polyglot', name: 'ðŸ—£ï¸ Polyglot', desc: 'Master of tongues and linguistic arts'}
            ];
            
            const specGrid = specContainer.querySelector('#specGrid') || specContainer;
            
            specGrid.innerHTML = specs.map(spec => {
                const specData = data.specializations?.[spec.id] || {unlocked: false, progress: 0};
                const locked = !isJourneyman && !specData.unlocked;
                const progress = specData.progress || 0;
                
                return `
                    <div class="spec-card ${locked ? 'locked' : 'unlocked'}" data-spec="${spec.id}">
                        <div class="spec-header">
                            <span class="spec-icon">${spec.name.split(' ')[0]}</span>
                            <div class="spec-info">
                                <div class="spec-title">${spec.name}</div>
                                <div class="spec-status">${locked ? 'ðŸ”’ Locked' : 'âœ“ Unlocked'}</div>
                            </div>
                        </div>
                        <p class="spec-description">${spec.desc}</p>
                        ${!locked ? `<div class="spec-progress"><div class="progress-bar" style="width: ${progress}%"></div></div>` : ''}
                    </div>
                `;
            }).join('');
            
            // Show specializations section if unlocked
            if (isJourneyman) {
                specContainer.style.display = 'block';
            }
        }

        // Display journal in view mode
        function loadJournalView(data) {
            const journalContainer = document.getElementById('journalText');
            if (!journalContainer) return;
            
            const reflection = data.journalReflection || 'No reflections yet. Begin your journey by recording your thoughts and insights here.';
            journalContainer.textContent = reflection;
            
            // Show the journal section if there's data
            const journalSection = document.getElementById('profileJournal');
            if (journalSection) {
                journalSection.style.display = 'block';
            }
        }

        // Save journal reflection standalone
        function saveJournalReflection() {
            const richProfile = JSON.parse(localStorage.getItem('grimorioProfile') || '{}');
            richProfile.journalReflection = document.getElementById('editJournal').value.trim() || richProfile.journalReflection || '';
            localStorage.setItem('grimorioProfile', JSON.stringify(richProfile));
            alert('ðŸ““ Reflection saved!');
            loadJournalView(richProfile);
        }

        // Profile Photo Functions
        function handleProfilePhotoUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoData = e.target.result;
                    
                    // Update edit preview
                    document.getElementById('editProfilePhotoPreview').innerHTML = `<img src="${photoData}" alt="Profile Photo">`;
                    
                    // Store in localStorage
                    localStorage.setItem('profilePhoto', photoData);
                };
                reader.readAsDataURL(file);
            }
        }

        function removeProfilePhoto() {
            // Remove from storage
            localStorage.removeItem('profilePhoto');
            
            // Reset previews to default
            document.getElementById('editProfilePhotoPreview').textContent = 'ðŸ“œ';
            document.getElementById('viewProfilePhoto').textContent = 'ðŸ“œ';
            document.getElementById('profileAvatar').textContent = 'ðŸ“œ';
            
            alert('Profile photo removed!');
        }

        function saveProfileChanges() {
            // Load existing profile or create new one
            let profileData = loadProfile();
            const richProfile = JSON.parse(localStorage.getItem('grimorioProfile') || '{}');
            
            // Update core profile fields
            richProfile.scribeName = document.getElementById('editScribeName').value.trim() || richProfile.scribeName || 'Unnamed Scribe';
            richProfile.personalMotto = document.getElementById('editPersonalMotto').value.trim() || richProfile.personalMotto || 'Amo Ä‰iujn, fidu malmultajn, difektu neniun';
            richProfile.currentFocus = document.getElementById('editCurrentFocus').value.trim() || richProfile.currentFocus || 'Beginning the path of the Three Virtues';
            richProfile.studiolLocation = document.getElementById('editStudioloLocation').value.trim() || richProfile.studiolLocation || 'My Sacred Space';
            richProfile.patronVirtue = document.getElementById('editPatronVirtue').value || richProfile.patronVirtue || 'thoth';
            richProfile.backstory = document.getElementById('editBackstory').value.trim() || richProfile.backstory || '';
            
            // Save journal reflection from Quill editor
            richProfile.journalReflection = getJournalContent() || richProfile.journalReflection || '';
            
            // Parse oath date
            const oathDateInput = document.getElementById('editOathDate').value;
            if (oathDateInput) {
                richProfile.oathDate = new Date(oathDateInput).toISOString();
            }
            
            // Parse goals
            const goalsText = document.getElementById('editGoals').value.trim();
            if (goalsText) {
                richProfile.goals = goalsText.split('\n').filter(g => g.trim());
            }
            
            // Save to localStorage
            localStorage.setItem('grimorioProfile', JSON.stringify(richProfile));
            
            // Update displayed name
            if (richProfile.scribeName) {
                document.getElementById('scribeName').textContent = richProfile.scribeName;
            }
            
            alert('âœ¨ Profile saved!');
            
            // Switch back to view mode and update display
            toggleProfileEdit();
            loadProfileIntoViewMode(richProfile);
            loadSpecializationsView(richProfile);
            loadJournalView(richProfile);
        }

        // Notes Functions
        function saveNote() {
            const category = document.getElementById('noteCategory').value;
            const content = getNoteContent();
            
            if (!category) {
                alert('Please select a category');
                return;
            }
            
            if (!content || content === '{"ops":[]}') {
                alert('Please write a note');
                return;
            }
            
            const note = {
                id: Date.now(),
                category: category,
                content: content,
                date: new Date().toISOString()
            };
            
            const notes = JSON.parse(localStorage.getItem('studyNotes') || '[]');
            notes.unshift(note);
            localStorage.setItem('studyNotes', JSON.stringify(notes));
            
            // Clear form
            document.getElementById('noteCategory').value = '';
            if (noteEditor) noteEditor.setContents([]);
            
            // Reload notes display
            loadNotesCompact();
            
            alert('âœ¨ Note saved!');
        }

        function loadNotesCompact() {
            const notes = JSON.parse(localStorage.getItem('studyNotes') || '[]');
            const container = document.getElementById('notesCompact');
            
            if (notes.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">No notes yet. Add your first study note above!</p>';
                return;
            }
            
            const categoryEmoji = {
                'herbal': 'ðŸŒ¿',
                'crystal': 'ðŸ’Ž',
                'lunar': 'ðŸŒ™',
                'philosophy': 'ðŸ“š',
                'practice': 'âš¡',
                'synchronicity': 'âœ¨',
                'personal': 'ðŸ’­'
            };
            
            container.innerHTML = notes.slice(0, 10).map(note => {
                const date = new Date(note.date);
                // Parse rich text content if it's JSON (Quill format), otherwise treat as plain text
                let displayContent = note.content;
                try {
                    const parsed = JSON.parse(note.content);
                    if (parsed.ops) {
                        // Convert Quill Delta to HTML
                        displayContent = parsed.ops.map(op => {
                            if (op.insert) {
                                let text = String(op.insert).replace(/\n/g, '<br>');
                                if (op.attributes) {
                                    if (op.attributes.bold) text = `<strong>${text}</strong>`;
                                    if (op.attributes.italic) text = `<em>${text}</em>`;
                                    if (op.attributes.underline) text = `<u>${text}</u>`;
                                }
                                return text;
                            }
                            return '';
                        }).join('');
                    }
                } catch (e) {
                    // Not JSON, use as-is
                    displayContent = note.content.replace(/\n/g, '<br>');
                }
                
                return `
                    <div class="note-item-compact" id="note-${note.id}">
                        <div class="note-header-compact">
                            <div class="note-date-compact">${date.toLocaleDateString()} ${date.toLocaleTimeString()}</div>
                            <div class="note-category-compact">${categoryEmoji[note.category] || 'ðŸ“'} ${note.category}</div>
                        </div>
                        <div class="note-content-compact" id="content-${note.id}" contenteditable="false">${displayContent}</div>
                        <div class="note-actions-compact">
                            <button class="note-edit-compact" onclick="editNoteCompact(${note.id})">âœï¸ Edit</button>
                            <button class="note-delete-compact" onclick="deleteNoteCompact(${note.id})">ðŸ—‘ï¸ Delete</button>
                        </div>
                        <button class="note-save-edit" id="save-${note.id}" style="display: none;" onclick="saveNoteEdit(${note.id})">ðŸ’¾ Save Changes</button>
                    </div>
                `;
            }).join('');
        }

        function editNoteCompact(noteId) {
            const contentEl = document.getElementById(`content-${noteId}`);
            const saveBtn = document.getElementById(`save-${noteId}`);
            
            contentEl.contentEditable = 'true';
            contentEl.focus();
            contentEl.style.background = 'rgba(139, 111, 216, 0.1)';
            contentEl.style.borderLeft = '3px solid var(--caerus-gold)';
            contentEl.style.padding = '10px';
            saveBtn.style.display = 'block';
        }

        function saveNoteEdit(noteId) {
            const contentEl = document.getElementById(`content-${noteId}`);
            const newContent = contentEl.innerText.trim();
            
            if (!newContent) {
                alert('Note cannot be empty!');
                return;
            }
            
            const notes = JSON.parse(localStorage.getItem('studyNotes') || '[]');
            const noteIndex = notes.findIndex(n => n.id === noteId);
            
            if (noteIndex !== -1) {
                notes[noteIndex].content = newContent;
                localStorage.setItem('studyNotes', JSON.stringify(notes));
                
                // Reset styling
                contentEl.contentEditable = 'false';
                contentEl.style.background = '';
                contentEl.style.borderLeft = '';
                contentEl.style.padding = '';
                document.getElementById(`save-${noteId}`).style.display = 'none';
                
                alert('âœ¨ Note updated!');
            }
        }

        function deleteNoteCompact(id) {
            if (!confirm('Delete this note?')) return;
            
            const notes = JSON.parse(localStorage.getItem('studyNotes') || '[]');
            const filtered = notes.filter(note => note.id !== id);
            localStorage.setItem('studyNotes', JSON.stringify(filtered));
            loadNotesCompact();
        }

        // Toolkit Functions
        function switchToolkitTab(tabName) {
            // Hide all toolkit subtab contents
            document.querySelectorAll('.toolkit-subtab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all toolkit subtabs
            document.querySelectorAll('.toolkit-subtab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected subtab content
            document.getElementById(tabName + 'Toolkit').classList.add('active');
            
            // Add active class to clicked subtab
            event.target.classList.add('active');
        }

        function toggleCategory(categoryId) {
            const itemsDiv = document.getElementById('items-' + categoryId);
            if (itemsDiv.style.display === 'none') {
                itemsDiv.style.display = 'block';
            } else {
                itemsDiv.style.display = 'none';
            }
        }

        function toggleToolkitCheck(checkbox) {
            const item = checkbox.closest('.checklist-item-compact');
            const category = item.dataset.category;
            const id = item.dataset.id;
            const key = `toolkit_${category}_${id}`;
            
            localStorage.setItem(key, checkbox.checked);
            
            updateToolkitProgress();
            updateCategoryCount(category);
        }

        // Quest System Functions
        function initializeQuestSystem() {
            checkQuestResets();
            loadAllQuests();
            startQuestTimers();
            // Mark debug status
            window.__debug = window.__debug || {};
            window.__debug.questsInitialized = true;
            updateDebugBadge(window.__debug);
        }

        function checkQuestResets() {
            const now = new Date();
            const questProgress = JSON.parse(localStorage.getItem('questProgress') || '{}');
            
            // Check daily reset (midnight)
            const lastDailyReset = questProgress.lastDailyReset ? new Date(questProgress.lastDailyReset) : null;
            if (!lastDailyReset || now.toDateString() !== lastDailyReset.toDateString()) {
                questProgress.completedDaily = [];
                questProgress.lastDailyReset = now.toISOString();
            }
            
            // Check weekly reset (Monday at midnight)
            const lastWeeklyReset = questProgress.lastWeeklyReset ? new Date(questProgress.lastWeeklyReset) : null;
            const weekStart = getWeekStart(now);
            if (!lastWeeklyReset || weekStart.toDateString() !== getWeekStart(lastWeeklyReset).toDateString()) {
                questProgress.completedWeekly = [];
                questProgress.lastWeeklyReset = now.toISOString();
            }
            
            // Check monthly reset (1st of month at midnight)
            const lastMonthlyReset = questProgress.lastMonthlyReset ? new Date(questProgress.lastMonthlyReset) : null;
            if (!lastMonthlyReset || now.getMonth() !== lastMonthlyReset.getMonth() || now.getFullYear() !== lastMonthlyReset.getFullYear()) {
                questProgress.completedMonthly = [];
                questProgress.lastMonthlyReset = now.toISOString();
            }
            
            localStorage.setItem('questProgress', JSON.stringify(questProgress));
        }

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Adjust when day is Sunday
            return new Date(d.setDate(diff));
        }

        function loadAllQuests() {
            loadQuests('daily', getQuestData().daily);
            loadQuests('weekly', getQuestData().weekly);
            loadQuests('monthly', getQuestData().monthly);
        }

        function getQuestData() {
            return {
                daily: [
                    {
                        id: 'daily-study',
                        name: 'Morning Study',
                        description: 'Read and take notes for at least 15 minutes',
                        virtue: 'thoth',
                        emoji: 'ðŸŒ™',
                        experience: 10
                    },
                    {
                        id: 'daily-practice',
                        name: 'Daily Practice',
                        description: 'Complete one working or ritual practice',
                        virtue: 'maat',
                        emoji: 'âš–ï¸',
                        experience: 10
                    },
                    {
                        id: 'daily-journal',
                        name: 'Reflection Journal',
                        description: 'Write a journal entry about your progress',
                        virtue: 'caerus',
                        emoji: 'âš¡',
                        experience: 10
                    }
                ],
                weekly: [
                    {
                        id: 'weekly-volumes',
                        name: 'Volume Reading',
                        description: 'Complete reading one full volume',
                        virtue: 'thoth',
                        emoji: 'ðŸŒ™',
                        experience: 50
                    },
                    {
                        id: 'weekly-cleansing',
                        name: 'Cleansing Ritual',
                        description: 'Perform a cleansing or balancing ritual',
                        virtue: 'maat',
                        emoji: 'âš–ï¸',
                        experience: 50
                    },
                    {
                        id: 'weekly-moon',
                        name: 'Lunar Observation',
                        description: 'Track moon phases and planetary hours',
                        virtue: 'caerus',
                        emoji: 'âš¡',
                        experience: 50
                    }
                ],
                monthly: [
                    {
                        id: 'monthly-mastery',
                        name: 'Path of Mastery',
                        description: 'Practice daily for 20+ days this month',
                        virtue: 'thoth',
                        emoji: 'ðŸŒ™',
                        experience: 150
                    },
                    {
                        id: 'monthly-balance',
                        name: 'Balanced Practice',
                        description: 'Complete quests in all three virtues',
                        virtue: 'maat',
                        emoji: 'âš–ï¸',
                        experience: 150
                    },
                    {
                        id: 'monthly-timing',
                        name: 'Perfect Timing',
                        description: 'Complete 10 workings during optimal planetary hours',
                        virtue: 'caerus',
                        emoji: 'âš¡',
                        experience: 150
                    }
                ]
            };
        }

        function loadQuests(frequency, quests) {
            const container = document.getElementById(`${frequency}Quests`);
            if (!container) return;
            
            const questProgress = JSON.parse(localStorage.getItem('questProgress') || '{}');
            const completedKey = `completed${frequency.charAt(0).toUpperCase() + frequency.slice(1)}`;
            const completed = questProgress[completedKey] || [];
            
            container.innerHTML = quests.map(quest => {
                const isCompleted = completed.includes(quest.id);
                return `
                    <div class="quest-card ${isCompleted ? 'completed' : ''}" data-quest-id="${quest.id}">
                        <div class="quest-header">
                            <div class="quest-title">${quest.name}</div>
                            <div class="quest-virtue">${quest.emoji}</div>
                        </div>
                        <div class="quest-description">${quest.description}</div>
                        <div class="quest-footer">
                            <div class="quest-reward">+${quest.experience} ${quest.virtue.toUpperCase()} XP</div>
                            <input 
                                type="checkbox" 
                                class="quest-checkbox" 
                                ${isCompleted ? 'checked disabled' : ''}
                                onchange="completeQuest('${frequency}', '${quest.id}', '${quest.virtue}', ${quest.experience})"
                            >
                        </div>
                    </div>
                `;
            }).join('');
        }

        function completeQuest(frequency, questId, virtue, experience) {
            const questProgress = JSON.parse(localStorage.getItem('questProgress') || '{}');
            const completedKey = `completed${frequency.charAt(0).toUpperCase() + frequency.slice(1)}`;
            
            if (!questProgress[completedKey]) {
                questProgress[completedKey] = [];
            }
            
            // Add to completed list
            questProgress[completedKey].push(questId);
            localStorage.setItem('questProgress', JSON.stringify(questProgress));
            
            // Award experience using rpg-system.js
            if (window.grimorioRPG) {
                window.grimorioRPG.awardExperience(virtue, experience);
            }
            
            // Get quest name for activity feed
            const questData = getQuestData();
            const allQuests = [...questData.daily, ...questData.weekly, ...questData.monthly];
            const quest = allQuests.find(q => q.id === questId);
            const questName = quest ? quest.name : 'Quest';
            
            // Add to activity feed
            addActivityFeedItem(quest.emoji, `Completed ${questName}`, `+${experience} ${virtue.toUpperCase()} XP`);
            
            // Update UI
            const card = document.querySelector(`[data-quest-id="${questId}"]`);
            if (card) {
                card.classList.add('completed');
                const checkbox = card.querySelector('.quest-checkbox');
                checkbox.disabled = true;
            }
            
            // Show success message
            showQuestNotification(`Quest Complete! +${experience} ${virtue.toUpperCase()} XP`);
            
            // Refresh dashboard display
            const profile = loadProfile();
            updateUI(profile);
        }

        // Debug-only helper: complete all daily quests quickly
        function completeAllDailyQuestsDebug() {
            if (!isDebugEnabled()) {
                alert('Enable ðŸž Debug to use test actions.');
                return;
            }
            const questData = getQuestData();
            const progress = JSON.parse(localStorage.getItem('questProgress') || '{}');
            const completedDaily = progress.completedDaily || [];
            const toComplete = questData.daily.filter(q => !completedDaily.includes(q.id));
            if (toComplete.length === 0) {
                showQuestNotification('All daily quests already completed.');
                return;
            }
            toComplete.forEach((q, idx) => {
                setTimeout(() => {
                    completeQuest('daily', q.id, q.virtue, q.experience);
                }, idx * 200);
            });
        }

        function showQuestNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, var(--thoth-deep), var(--mystic-purple));
                color: var(--caerus-gold);
                padding: 15px 25px;
                border-radius: 8px;
                border: 2px solid var(--caerus-gold);
                font-family: 'Cinzel', serif;
                font-size: 1.1rem;
                z-index: 10000;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
                animation: slideInRight 0.5s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        function startQuestTimers() {
            updateQuestTimers();
            setInterval(updateQuestTimers, 1000);
        }

        function updateQuestTimers() {
            const now = new Date();
            
            // Daily timer (until midnight)
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            updateTimer('dailyTimer', tomorrow - now);
            
            // Weekly timer (until next Monday)
            const nextMonday = new Date(now);
            const daysUntilMonday = (8 - nextMonday.getDay()) % 7 || 7;
            nextMonday.setDate(nextMonday.getDate() + daysUntilMonday);
            nextMonday.setHours(0, 0, 0, 0);
            updateTimer('weeklyTimer', nextMonday - now);
            
            // Monthly timer (until 1st of next month)
            const nextMonth = new Date(now);
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            nextMonth.setDate(1);
            nextMonth.setHours(0, 0, 0, 0);
            updateTimer('monthlyTimer', nextMonth - now);
        }

        function updateTimer(elementId, ms) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const hours = Math.floor(ms / (1000 * 60 * 60));
            const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((ms % (1000 * 60)) / 1000);
            
            element.textContent = `${hours}h ${minutes}m ${seconds}s`;
        }

        // Activity Feed Functions
        function addActivityFeedItem(icon, text, details) {
            // Load existing activities
            let activities = JSON.parse(localStorage.getItem('activityFeed') || '[]');
            
            // Add new activity at the beginning
            activities.unshift({
                icon: icon,
                text: text,
                details: details,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 20 activities
            if (activities.length > 20) {
                activities = activities.slice(0, 20);
            }
            
            // Save back to localStorage
            localStorage.setItem('activityFeed', JSON.stringify(activities));
            
            // Refresh display
            displayActivityFeed();
        }

        function displayActivityFeed() {
            const activities = JSON.parse(localStorage.getItem('activityFeed') || '[]');
            const feedContainer = document.getElementById('activityFeed');
            
            if (!feedContainer) return;
            // Mark debug status and update badge
            window.__debug = window.__debug || {};
            window.__debug.activityInitialized = true;
            updateDebugBadge(window.__debug);
            
            if (activities.length === 0) {
                feedContainer.innerHTML = `
                    <div class="activity-item" style="opacity: 0.5; text-align: center; padding: 30px;">
                        <div class="activity-content">
                            <div class="activity-text">No activities yet. Complete quests, write journal entries, or log workings to see your activity here!</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            feedContainer.innerHTML = activities.map(activity => {
                const timestamp = new Date(activity.timestamp);
                const timeAgo = getTimeAgo(timestamp);
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon">${activity.icon}</div>
                        <div class="activity-content">
                            <div class="activity-text">${activity.text}</div>
                            <div class="activity-time">${timeAgo} â€¢ ${activity.details}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return 'Just now';
            
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            
            const days = Math.floor(hours / 24);
            if (days === 1) return 'Yesterday';
            if (days < 7) return `${days} days ago`;
            
            const weeks = Math.floor(days / 7);
            if (weeks === 1) return '1 week ago';
            if (weeks < 4) return `${weeks} weeks ago`;
            
            return date.toLocaleDateString();
        }

        function updateToolkitProgress() {
            const allItems = document.querySelectorAll('.checklist-item-compact');
            const checkedItems = Array.from(allItems).filter(item => {
                const checkbox = item.querySelector('.checkbox-compact');
                return checkbox && checkbox.checked;
            });
            
            const total = allItems.length;
            const completed = checkedItems.length;
            
            document.getElementById('toolkitProgress').textContent = `${completed} / ${total}`;
        }

        // Debug helpers
        function isDebugEnabled() {
            return localStorage.getItem('debugEnabled') === 'true';
        }

        function toggleDebugMode() {
            const enabled = isDebugEnabled();
            localStorage.setItem('debugEnabled', (!enabled).toString());
            updateDebugBadge(window.__debug || {});
            const btn = document.getElementById('navDebugBtn');
            if (btn) btn.textContent = (!enabled) ? 'ðŸž Debug (On)' : 'ðŸž Debug';
        }

        function updateDebugBadge(status) {
            const badge = document.getElementById('debugBadge');
            const debugBtn = document.getElementById('debugCompleteDailyBtn');
            if (!badge) return;
            if (!isDebugEnabled()) {
                badge.style.display = 'none';
                if (debugBtn) debugBtn.style.display = 'none';
                return;
            }
            const q = status && status.questsInitialized ? 'âœ“' : 'â€¦';
            const a = status && status.activityInitialized ? 'âœ“' : 'â€¦';
            badge.textContent = `ðŸž Debug: Quests ${q} â€¢ Activity ${a}`;
            badge.style.display = 'inline-block';
            if (debugBtn) debugBtn.style.display = 'inline-block';
        }

        function updateCategoryCount(categoryId) {
            const categoryItems = document.querySelectorAll(`[data-category="${categoryId}"]`);
            const checkedItems = Array.from(categoryItems).filter(item => {
                const checkbox = item.querySelector('.checkbox-compact');
                return checkbox && checkbox.checked;
            });
            
            const countSpan = document.getElementById(`count-${categoryId}`);
            if (countSpan) {
                countSpan.textContent = `(${checkedItems.length}/${categoryItems.length})`;
            }
        }

        function loadToolkitState() {
            // Load all saved checkbox states
            document.querySelectorAll('.checklist-item-compact').forEach(item => {
                const category = item.dataset.category;
                const id = item.dataset.id;
                const key = `toolkit_${category}_${id}`;
                const isChecked = localStorage.getItem(key) === 'true';
                
                const checkbox = item.querySelector('.checkbox-compact');
                if (checkbox) {
                    checkbox.checked = isChecked;
                }
            });
            
            // Update all counters
            const categories = ['studiolo', 'herbal', 'crystal', 'writing', 'lunar', 'protection'];
            categories.forEach(cat => updateCategoryCount(cat));
            updateToolkitProgress();
        }

        // Quill Editor Instances
        let journalEditor = null;
        let noteEditor = null;

        // Initialize Quill Rich Text Editors
        function initializeQuillEditors() {
            // Journal Reflection Editor
            journalEditor = new Quill('#editJournalReflection', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        ['bold', 'italic', 'underline'],
                        ['blockquote'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['link']
                    ]
                },
                placeholder: 'Write your thoughts about your journey through the Three Virtues...'
            });

            // Note Editor
            noteEditor = new Quill('#noteContentEditor', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        ['bold', 'italic', 'underline'],
                        ['blockquote'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['code-block'],
                        ['link']
                    ]
                },
                placeholder: 'Write your note...'
            });

            // Load saved reflection into journal editor
            const saved = localStorage.getItem('grimorioProfile');
            if (saved) {
                const data = JSON.parse(saved);
                if (data.journalReflection) {
                    journalEditor.setContents(JSON.parse(data.journalReflection));
                }
            }
        }

        // Update save functions to use Quill content
        function getJournalContent() {
            if (!journalEditor) return '';
            return JSON.stringify(journalEditor.getContents());
        }

        function getNoteContent() {
            if (!noteEditor) return '';
            return JSON.stringify(noteEditor.getContents());
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const profile = loadProfile();
            updateUI(profile);
            
            // Initialize dashboard section on page load
            switchSection('dashboard');
            
            // Load profile view mode (this updates the profile card with real data)
            loadProfileView();
            
            // Load profile edit mode data
            loadProfileEdit();

            // Initialize Quill Rich Text Editors
            initializeQuillEditors();
            
            // Initialize Quest System
            initializeQuestSystem();
            
            // Display Activity Feed
            displayActivityFeed();
            
            // Ensure debug reflects current state
            updateDebugBadge(window.__debug || {});
            
            // Check if auto-sync is enabled
            if (localStorage.getItem('autoSyncEnabled') === 'true') {
                // Update both sync buttons
                const syncBtns = document.querySelectorAll('#syncModeBtn, #navSyncBtn');
                syncBtns.forEach(btn => btn.classList.add('auto-sync-enabled'));
                
                autoSyncTimer = setInterval(syncToCloud, AUTO_SYNC_INTERVAL);
                setInterval(loadFromCloud, AUTO_SYNC_INTERVAL);
            }
            
            setTimeout(() => {
                const progressBars = document.querySelectorAll('.progress-fill, .virtue-progress-fill');
                progressBars.forEach(bar => {
                    const width = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 100);
                });
            }, 100);
        });
    </script>
</body>
</html>